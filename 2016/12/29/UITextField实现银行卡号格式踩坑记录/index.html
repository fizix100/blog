<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>æ™¨æ˜Ÿ_é£çš„åšå®¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="UITextFieldå®ç°é“¶è¡Œå¡å·æ ¼å¼è¸©å‘è®°å½•ä¸Šæ¬¡æ¥åˆ°ä¸€ä¸ªâ€œå¾ˆå°çš„éœ€æ±‚â€æ˜¯UITextFieldè¾“å…¥çš„æ•°å­—ç¼–å·è¦æ¯éš”4ä½æ’å…¥ä¸€ä¸ªç©ºæ ¼ï¼Œä¹ä¸€çœ‹å¥½åƒå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨textFieldçš„delegateæ–¹æ³•(shouldChangeCharactersInRange)é‡Œé¢åŠ ä¸€äº›ç®€å•çš„åˆ¤æ–­å¹¶æ’å…¥ç©ºæ ¼å³å¯ï¼Œç„¶è€Œäº‹å®å¹¶ä¸æ˜¯è¿™æ ·ï¼Œè¿™ä¸ªå°å°çš„éœ€æ±‚éšè—äº†å„ç§å°å‘ï¼›
æœ€ç®€å•çš„å®ç°è¿™ä¸ªéœ€æ±‚æœ€ç›´è§‚çš„å®ç°æ–¹å¼å°±æ˜¯ï¼Œåœ¨ä»£ç†æ–¹">
<meta property="og:type" content="article">
<meta property="og:title" content="æ™¨æ˜Ÿ_é£çš„åšå®¢">
<meta property="og:url" content="http://yoursite.com/blog/2016/12/29/UITextFieldå®ç°é“¶è¡Œå¡å·æ ¼å¼è¸©å‘è®°å½•/index.html">
<meta property="og:site_name" content="æ™¨æ˜Ÿ_é£çš„åšå®¢">
<meta property="og:description" content="UITextFieldå®ç°é“¶è¡Œå¡å·æ ¼å¼è¸©å‘è®°å½•ä¸Šæ¬¡æ¥åˆ°ä¸€ä¸ªâ€œå¾ˆå°çš„éœ€æ±‚â€æ˜¯UITextFieldè¾“å…¥çš„æ•°å­—ç¼–å·è¦æ¯éš”4ä½æ’å…¥ä¸€ä¸ªç©ºæ ¼ï¼Œä¹ä¸€çœ‹å¥½åƒå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨textFieldçš„delegateæ–¹æ³•(shouldChangeCharactersInRange)é‡Œé¢åŠ ä¸€äº›ç®€å•çš„åˆ¤æ–­å¹¶æ’å…¥ç©ºæ ¼å³å¯ï¼Œç„¶è€Œäº‹å®å¹¶ä¸æ˜¯è¿™æ ·ï¼Œè¿™ä¸ªå°å°çš„éœ€æ±‚éšè—äº†å„ç§å°å‘ï¼›
æœ€ç®€å•çš„å®ç°è¿™ä¸ªéœ€æ±‚æœ€ç›´è§‚çš„å®ç°æ–¹å¼å°±æ˜¯ï¼Œåœ¨ä»£ç†æ–¹">
<meta property="og:updated_time" content="2017-01-03T02:06:50.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="æ™¨æ˜Ÿ_é£çš„åšå®¢">
<meta name="twitter:description" content="UITextFieldå®ç°é“¶è¡Œå¡å·æ ¼å¼è¸©å‘è®°å½•ä¸Šæ¬¡æ¥åˆ°ä¸€ä¸ªâ€œå¾ˆå°çš„éœ€æ±‚â€æ˜¯UITextFieldè¾“å…¥çš„æ•°å­—ç¼–å·è¦æ¯éš”4ä½æ’å…¥ä¸€ä¸ªç©ºæ ¼ï¼Œä¹ä¸€çœ‹å¥½åƒå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨textFieldçš„delegateæ–¹æ³•(shouldChangeCharactersInRange)é‡Œé¢åŠ ä¸€äº›ç®€å•çš„åˆ¤æ–­å¹¶æ’å…¥ç©ºæ ¼å³å¯ï¼Œç„¶è€Œäº‹å®å¹¶ä¸æ˜¯è¿™æ ·ï¼Œè¿™ä¸ªå°å°çš„éœ€æ±‚éšè—äº†å„ç§å°å‘ï¼›
æœ€ç®€å•çš„å®ç°è¿™ä¸ªéœ€æ±‚æœ€ç›´è§‚çš„å®ç°æ–¹å¼å°±æ˜¯ï¼Œåœ¨ä»£ç†æ–¹">
  
  
  <script src="/blog/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://oerkxd2a0.bkt.clouddn.com/zizhan/1476063479228.png" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">æ™¨æ˜Ÿã€é£</a></h1>
		</hgroup>

		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/blog/blog">ä¸»é¡µ</a></li>
	        
				<li><a href="/blog/archives">æ‰€æœ‰æ–‡ç« </a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">å‹æƒ…é“¾æ¥</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="http://github.com/fizix100" title="github">github</a>
		        
					<a class="weibo" target="_blank" href="http://weibo.com/fizix100" title="weibo">weibo</a>
		        
					<a class="zhihu" target="_blank" href="http://zhihu.com/people/fizix100" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">æ™¨æ˜Ÿã€é£</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="/blog/http://oerkxd2a0.bkt.clouddn.com/zizhan/1476063479228.png" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
				
			</div>
			<hgroup>
			  <h1 class="header-author">æ™¨æ˜Ÿã€é£</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/blog/blog">ä¸»é¡µ</a></li>
		        
					<li><a href="/blog/archives">æ‰€æœ‰æ–‡ç« </a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="http://github.com/fizix100" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/fizix100" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="http://zhihu.com/people/fizix100" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        <article id="post-UITextFieldå®ç°é“¶è¡Œå¡å·æ ¼å¼è¸©å‘è®°å½•" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="UITextFieldå®ç°é“¶è¡Œå¡å·æ ¼å¼è¸©å‘è®°å½•"><a href="#UITextFieldå®ç°é“¶è¡Œå¡å·æ ¼å¼è¸©å‘è®°å½•" class="headerlink" title="UITextFieldå®ç°é“¶è¡Œå¡å·æ ¼å¼è¸©å‘è®°å½•"></a><strong>UITextFieldå®ç°é“¶è¡Œå¡å·æ ¼å¼è¸©å‘è®°å½•</strong></h2><p>ä¸Šæ¬¡æ¥åˆ°ä¸€ä¸ªâ€œå¾ˆå°çš„éœ€æ±‚â€æ˜¯UITextFieldè¾“å…¥çš„æ•°å­—ç¼–å·è¦æ¯éš”4ä½æ’å…¥ä¸€ä¸ªç©ºæ ¼ï¼Œä¹ä¸€çœ‹å¥½åƒå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨textFieldçš„delegateæ–¹æ³•(shouldChangeCharactersInRange)é‡Œé¢åŠ ä¸€äº›ç®€å•çš„åˆ¤æ–­å¹¶æ’å…¥ç©ºæ ¼å³å¯ï¼Œç„¶è€Œäº‹å®å¹¶ä¸æ˜¯è¿™æ ·ï¼Œè¿™ä¸ªå°å°çš„éœ€æ±‚éšè—äº†å„ç§å°å‘ï¼›</p>
<h3 id="æœ€ç®€å•çš„å®ç°"><a href="#æœ€ç®€å•çš„å®ç°" class="headerlink" title="æœ€ç®€å•çš„å®ç°"></a>æœ€ç®€å•çš„å®ç°</h3><p>è¿™ä¸ªéœ€æ±‚æœ€ç›´è§‚çš„å®ç°æ–¹å¼å°±æ˜¯ï¼Œåœ¨ä»£ç†æ–¹æ³•ä¸­åŠ åˆ¤æ–­æ’å…¥ç©ºæ ¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)textField:(<span class="built_in">UITextField</span> *)textField shouldChangeCharactersInRange:(<span class="built_in">NSRange</span>)range replacementString:(<span class="built_in">NSString</span> *)string</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ((textField.text.length+<span class="number">1</span>) % <span class="number">5</span> == <span class="number">0</span> &amp;&amp; textField.text.length &gt; <span class="number">0</span> &amp;&amp; string.length &gt; <span class="number">0</span>) &#123;</div><div class="line">        textField.text = [textField.text stringByAppendingString:<span class="string">@" "</span>];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç»è¿‡å„ç§ç®€åŒ–æç‚¼ï¼Œå°†å„ç§é€»è¾‘ç®€åŒ–ä¸º1ä¸ªifåˆ¤æ–­è¯­å¥å’Œä¸€è¡Œæ’å…¥ç©ºæ ¼çš„ä»£ç ï¼šæ¡ä»¶æœ‰3ä¸ªï¼šâ‘ å­—ç¬¦ä¸²çš„é•¿åº¦(ä¸å«ç©ºæ ¼)å¯ä»¥è¢«4æ•´é™¤ï¼›â‘¡å­—ç¬¦ä¸²çš„é•¿åº¦å¤§äº0ï¼›â‘¢æœ¬æ¬¡ç¼–è¾‘æ˜¯è¾“å…¥åŠ¨ä½œã€‚ä»¥ä¸Šä»£ç å¯ä»¥æ»¡è¶³æœ€åŸºæœ¬çš„éœ€æ±‚ï¼Œå­—ç¬¦çš„è¾“å‡ºæ ¼å¼ä¸€èˆ¬ä¸ä¼šå‡ºé”™ğŸ˜ã€‚ç„¶è€Œæ®‹é…·çš„ç°å®å‘Šè¯‰ä½ è¿™ä¸ªéœ€æ±‚çœŸçš„æ²¡è¿™ä¹ˆç®€å•ï¼ï¼ï¼</p>
<h3 id="æµ‹è¯•çš„æ— æƒ…é­æŒ"><a href="#æµ‹è¯•çš„æ— æƒ…é­æŒ" class="headerlink" title="æµ‹è¯•çš„æ— æƒ…é­æŒ"></a>æµ‹è¯•çš„æ— æƒ…é­æŒ</h3><p>ä»¥ä¸Šä»£ç ç®€å•æ¸…æ™°ï¼Œè²Œä¼¼å¾ˆå®Œç¾ï¼Œä½†ä¹Ÿä»…ä»…æ˜¯è²Œä¼¼ã€‚è¿™ä¸ªç®€å•çš„é€»è¾‘åˆ¤æ–­çš„å®Œç¾è¡¨ç°æœ‰ä¸€ä¸ªå‰ææ¡ä»¶ï¼šç”¨æˆ·ä¸ä¼šæ‰‹åŠ¨å»ç§»åŠ¨å…‰æ ‡ï¼Œä»…æŒ‰å­—ç¬¦è¾“å…¥é”®æˆ–åˆ é™¤é”®æ¥è¾“å…¥æˆ–åˆ é™¤å­—ç¬¦ã€‚æ­¤æ—¶ä¸»è¦æœ‰2ä¸ªbugï¼šâ‘ å…‰æ ‡ä¸åœ¨æœ«å°¾çš„æ—¶å€™ä¸Šé¢çš„æ’å…¥ç©ºæ ¼é€»è¾‘ä¼šå¤±æ•ˆï¼Œå› ä¸ºåˆ¤æ–­é€»è¾‘è™½ç„¶æ²¡é”™ï¼Œä½†æ˜¯è¾“å…¥æˆ–åˆ é™¤å­—ç¬¦çš„ä½ç½®å˜æ‰äº†ï¼Œå®é™…è¾“å‡ºçš„å­—ç¬¦å°±ä¼šä¹±æ‰ã€‚â‘¡å› ä¸º<code>textField.text = xxx;</code>è¿™è¡Œèµ‹å€¼ä»£ç è¿è¡Œä¹‹åä¼šè‡ªåŠ¨å°†å…‰æ ‡ç§»åŠ¨åˆ°textFieldçš„æœ«å°¾ï¼Œæ‰€ä»¥å¦‚æœç”¨æˆ·çš„å…‰æ ‡ä¸åœ¨æœ«å°¾ï¼Œè¾“å…¥æˆ–åˆ é™¤æŸä¸ªå­—ç¬¦ä¹‹åå…‰æ ‡å°†ç§»åŠ¨åˆ°æœ«å°¾ğŸ˜‚ï¼Œç”¨æˆ·è¡¨ç¤ºä¸€è„¸æ‡µé€¼ğŸ˜³ã€‚</p>
<p>###è§£bugçš„è¯•ç‚¼</p>
<h4 id="å…ˆçœ‹ç¬¬ä¸€ä¸ªbugï¼Œç©ºæ ¼æ’å…¥çš„ä½ç½®ä¼šå‡ºé”™ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•è§£å†³å‘¢ï¼š"><a href="#å…ˆçœ‹ç¬¬ä¸€ä¸ªbugï¼Œç©ºæ ¼æ’å…¥çš„ä½ç½®ä¼šå‡ºé”™ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•è§£å†³å‘¢ï¼š" class="headerlink" title="å…ˆçœ‹ç¬¬ä¸€ä¸ªbugï¼Œç©ºæ ¼æ’å…¥çš„ä½ç½®ä¼šå‡ºé”™ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•è§£å†³å‘¢ï¼š"></a>å…ˆçœ‹ç¬¬ä¸€ä¸ªbugï¼Œç©ºæ ¼æ’å…¥çš„ä½ç½®ä¼šå‡ºé”™ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•è§£å†³å‘¢ï¼š</h4><p>å…ˆåˆ¤æ–­ä¸€ä¸‹å…‰æ ‡ä½ç½®ï¼Œç„¶åçœ‹ç”¨æˆ·å½“å‰æŒ‰çš„æ˜¯åˆ é™¤é”®è¿˜æ˜¯è¾“å…¥å­—ç¬¦é”®ï¼Œæ¥åˆ¤æ–­å½“å‰æ˜¯å¦éœ€è¦æ’å…¥ç©ºæ ¼ï¼Ÿ<br>è¿™ä¸ªåˆ¤æ–­æ¡ä»¶æ¯”è¾ƒç¹çï¼Œä¸ä»…éœ€è¦åˆ¤æ–­å½“å‰çš„å…‰æ ‡ä½ç½®æ˜¯å¦éœ€è¦æ’å…¥å­—ç¬¦ä¸²ï¼Œè€Œä¸”è¦è€ƒè™‘æ’æˆ–è€…ä¸æ’å…¥ç©ºæ ¼ä»¥åŠåœ¨è¾“å…¥/åˆ é™¤æŸä¸ªå­—ç¬¦æ—¶å€™æ•´ä½“å­—ç¬¦ä¸²çš„æ ¼å¼éœ€è¦å˜æ›´çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š<code>1234 |5678</code>ï¼Œå…‰æ ‡åœ¨5ä¹‹å‰ï¼Œç©ºæ ¼ä¹‹åï¼Œæ­¤æ—¶è¾“å…¥ä¸€ä¸ªå­—ç¬¦9çš„è¯ï¼Œéœ€è¦æ’å…¥ç©ºæ ¼çš„ä½ç½®æ˜¯åœ¨7å’Œ8ä¹‹é—´ï¼Œä¸º<code>1234 9|567 8</code>ï¼Œè¿™è¿˜æ˜¯å­—ç¬¦ä¸²æ¯”è¾ƒçŸ­çš„æƒ…å†µï¼Œå¦‚æœå­—ç¬¦ä¸²æ¯”è¾ƒé•¿ï¼Œè¿˜è¦è€ƒè™‘åé¢æ¯1ä¸ªç©ºæ ¼çš„åˆ é™¤åŠæ’å…¥ã€‚è¿™æ¡è·¯åº”è¯¥æ˜¯æœ‰è§£çš„ï¼Œä½†æ˜¯å¯èƒ½éœ€è¦èµ°è¿‡å±±è·¯18å¼¯ï¼Œå¯¹äºè¿˜æœ‰1å¤©å°±è¦ææµ‹çš„æˆ‘æ¥è¯´ï¼ŒçœŸå¿ƒç»•ä¸èµ·ğŸ¤¥ã€‚</p>
<p>æ²¡æƒ³åˆ°è¿™ä¹ˆä¸ªå°éœ€æ±‚éšè—ç€è¿™æ ·çš„å‘ï¼Œæ­¤åˆ»æˆ‘çš„å¿ƒæƒ…æ˜¯å“‡å‡‰å“‡å‡‰çš„ğŸ˜°ã€‚</p>
<h4 id="æ—¢ç„¶ç¬¬ä¸€ä¸ªbugæš‚æ—¶æ²¡æœ‰å¥½çš„è§£å†³æ–¹æ³•ï¼Œé‚£èƒ½ä¸èƒ½å…ˆè§£å†³ç¬¬äºŒä¸ªå‘¢ï¼Ÿ"><a href="#æ—¢ç„¶ç¬¬ä¸€ä¸ªbugæš‚æ—¶æ²¡æœ‰å¥½çš„è§£å†³æ–¹æ³•ï¼Œé‚£èƒ½ä¸èƒ½å…ˆè§£å†³ç¬¬äºŒä¸ªå‘¢ï¼Ÿ" class="headerlink" title="æ—¢ç„¶ç¬¬ä¸€ä¸ªbugæš‚æ—¶æ²¡æœ‰å¥½çš„è§£å†³æ–¹æ³•ï¼Œé‚£èƒ½ä¸èƒ½å…ˆè§£å†³ç¬¬äºŒä¸ªå‘¢ï¼Ÿ"></a>æ—¢ç„¶ç¬¬ä¸€ä¸ªbugæš‚æ—¶æ²¡æœ‰å¥½çš„è§£å†³æ–¹æ³•ï¼Œé‚£èƒ½ä¸èƒ½å…ˆè§£å†³ç¬¬äºŒä¸ªå‘¢ï¼Ÿ</h4><p>ç¬¬äºŒä¸ªbugæºè‡ªäº<code>textField.text = xxx;</code>è¿™è¡Œä»£ç ï¼Œå¯¹textFieldèµ‹å€¼ä¹‹åå…‰æ ‡è‡ªåŠ¨ç§»åŠ¨åˆ°æœ«å°¾ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥è®°å½•ä¸€ä¸‹èµ‹å€¼ä¹‹å‰çš„å…‰æ ‡ä½ç½®ï¼Œèµ‹å€¼ä¹‹åå†å°†å…‰æ ‡æ”¾å›å»å‘¢ï¼Ÿäºæ˜¯ä»£ç æ”¹æˆè¿™æ ·ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ((textField.text.length+<span class="number">1</span>) % <span class="number">5</span> == <span class="number">0</span> &amp;&amp; textField.text.length &gt; <span class="number">0</span> &amp;&amp; string.length &gt; <span class="number">0</span>) </div><div class="line">&#123;</div><div class="line">	<span class="built_in">UITextRange</span> *textRange = textField.selectedTextRange;</div><div class="line">	textField.text = [textField.text stringByAppendingString:<span class="string">@" "</span>];</div><div class="line">    textField.selectedTextRange = textRange;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿è¡Œä¹‹åå‘ç°ç©ºæ ¼éƒ½ä¸æ’å…¥äº†ï¼Œè¿™å°¼ç›ä»€ä¹ˆé¬¼ï¼Œç„¶åå°±å‘ç°åŸæ¥æ˜¯å› ä¸ºæŠŠå…‰æ ‡è¿˜åŸåˆ°åŸæ¥çš„ä½ç½®ä¹‹åç¼–è¾‘çš„ä½ç½®ä¹Ÿå˜æˆäº†æ’å…¥ç©ºæ ¼ä¹‹å‰çš„ä½ç½®ï¼Œå› æ­¤ç©ºæ ¼æ²¡æœ‰æ’å…¥ğŸ˜“ã€‚</p>
<p>äºæ˜¯å°±é™·å…¥äº†bugçš„æ±ªæ´‹å¤§æµ·ä¹‹ä¸­ï¼Œä½ è¿™æ ·è§£å†³å®ƒå°±é‚£æ ·å†’å‡ºæ¥ï¼Œä½ é‚£æ ·è§£å†³å®ƒå°±è¿™æ ·å†’å‡ºæ¥ğŸ˜¶</p>
<h4 id="æ¢ä¸€ç§æ€è·¯æ¥è§£å†³"><a href="#æ¢ä¸€ç§æ€è·¯æ¥è§£å†³" class="headerlink" title="æ¢ä¸€ç§æ€è·¯æ¥è§£å†³"></a>æ¢ä¸€ç§æ€è·¯æ¥è§£å†³</h4><p>æ—¢ç„¶ç”¨æˆ·çš„è¾“å…¥ä½ç½®ä¸å¯æ§ï¼Œè¾“å…¥ä¹‹åæ˜¯å¦æ’å…¥ç©ºæ ¼ä¹Ÿéœ€è¦ç”±æ¡ä»¶è€Œå®šï¼Œè¾“å…¥ä¹‹åå…‰æ ‡çš„ä½ç½®ä¹Ÿä¸å¯æ§ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯å¯æ§çš„ï¼Ÿç”¨æˆ·è¾“å…¥/åˆ é™¤ä¹‹åçš„å­—ç¬¦ä¸²(ä¸åŒ…å«ç©ºæ ¼)ï¼Œè¿™ä¸ªæ˜¯å¯æ§çš„ã€‚è€Œå…¶ä»–çš„ä¸å¯æ§å› ç´ éƒ½ä¾èµ–äºç¼–è¾‘ä¹‹åçš„å­—ç¬¦ä¸²ã€‚é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥é€šè¿‡ç¼–è¾‘ä¹‹åçš„å­—ç¬¦ä¸²æ¥æ‰¾ç­”æ¡ˆï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)textField:(<span class="built_in">UITextField</span> *)textField shouldChangeCharactersInRange:(<span class="built_in">NSRange</span>)range replacementString:(<span class="built_in">NSString</span> *)string</div><div class="line">&#123;</div><div class="line">    <span class="comment">//  ç¼–è¾‘ä¹‹åçš„å­—ç¬¦ä¸²</span></div><div class="line">    <span class="built_in">NSMutableString</span> *resultString = [<span class="built_in">NSMutableString</span> stringWithString:textField.text];</div><div class="line">    [resultString replaceCharactersInRange:range withString:string];</div><div class="line">    </div><div class="line">    <span class="comment">//  å…ˆå»é™¤ç©ºæ ¼</span></div><div class="line">    <span class="built_in">NSString</span> *noSpaceString = [resultString stringByReplacingOccurrencesOfString:<span class="string">@" "</span> withString:<span class="string">@""</span>];</div><div class="line">    resultString = [<span class="built_in">NSMutableString</span> stringWithString:noSpaceString];</div><div class="line">    </div><div class="line">    <span class="comment">//  æ¯å››ä½æ’å…¥1ä¸ªç©ºæ ¼</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i=<span class="number">0</span>; i&lt;resultString.length/<span class="number">5</span>; i++) &#123;</div><div class="line">        [resultString insertString:<span class="string">@" "</span> atIndex:i*<span class="number">5</span>+<span class="number">4</span>];</div><div class="line">    &#125;</div><div class="line">    textField.text = resultString;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä»£ç å¯ä»¥ç¼–è¾‘ä¹‹åçš„å­—ç¬¦ä¸²æ ¼å¼ä¸ä¼šå‡ºé”™ï¼Œæ¯éš”4ä½æ’å…¥1ä¸ªç©ºæ ¼ï¼Œå› ä¸ºè¾“å…¥æºæ˜¯å›ºå®šçš„ã€‚ä½†æ˜¯è¿˜é—ç•™æœ‰1ä¸ªé—®é¢˜å°±æ˜¯é€šè¿‡<code>textField.text = resultString</code>èµ‹å€¼ä¹‹åçš„å…‰æ ‡ä½ç½®ä¸€å®šæ˜¯åœ¨æœ«å°¾ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚è¿™ä¸ªbugçš„è§£å†³æ€è·¯è¿˜æ˜¯åœ¨ä¸Šé¢é‚£ä¸€æ­¥ï¼Œå³å…ˆè®°å½•èµ‹å€¼ä¹‹å‰å…‰æ ‡çš„ä½ç½®ï¼Œèµ‹å€¼ä¹‹åå†å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¹‹å‰çš„ä½ç½®ï¼Œåªæ˜¯ä»£ç ä¸æ˜¯ç®€å•çš„2è¡Œäº†ï¼Œè€Œéœ€è¦è€ƒè™‘ç¼–è¾‘ä¹‹åå…‰æ ‡ä½ç½®çš„å˜åŒ–ï¼šå¦‚æœæ˜¯åˆ é™¤ï¼Œå…‰æ ‡çš„è¿ç« ä¼šå‘å‰ç§»åŠ¨ï¼›å¦‚æœæ˜¯è¾“å…¥ï¼Œå…‰æ ‡ä¼šå‘åç§»åŠ¨1ä½ï¼Œå¦‚æœåŒæ—¶åˆç©ºæ ¼æ’å…¥ï¼Œåˆ™å…‰æ ‡éœ€è¦å‘åç§»åŠ¨2ä½ï¼›äºæ˜¯ä»£ç å˜æˆäº†ä¸‹é¢çš„ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)textField:(<span class="built_in">UITextField</span> *)textField shouldChangeCharactersInRange:(<span class="built_in">NSRange</span>)range replacementString:(<span class="built_in">NSString</span> *)string</div><div class="line">&#123;</div><div class="line">    <span class="comment">//  ç¼–è¾‘ä¹‹åçš„å­—ç¬¦ä¸²</span></div><div class="line">    <span class="built_in">NSMutableString</span> *resultString = [<span class="built_in">NSMutableString</span> stringWithString:textField.text];</div><div class="line">    [resultString replaceCharactersInRange:range withString:string];</div><div class="line">    </div><div class="line">    <span class="comment">//  å…ˆå»é™¤ç©ºæ ¼</span></div><div class="line">    <span class="built_in">NSString</span> *noSpaceString = [resultString stringByReplacingOccurrencesOfString:<span class="string">@" "</span> withString:<span class="string">@""</span>];</div><div class="line">    resultString = [<span class="built_in">NSMutableString</span> stringWithString:noSpaceString];</div><div class="line">    </div><div class="line">    <span class="comment">//  æ¯å››ä½æ’å…¥1ä¸ªç©ºæ ¼</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i=<span class="number">0</span>; i&lt;resultString.length/<span class="number">5</span>; i++) &#123;</div><div class="line">        [resultString insertString:<span class="string">@" "</span> atIndex:i*<span class="number">5</span>+<span class="number">4</span>];</div><div class="line">    &#125;</div><div class="line">    textField.text = resultString;</div><div class="line">    </div><div class="line">    <span class="comment">//  è®¡ç®—å…‰æ ‡ä½ç½®å¹¶èµ‹å€¼</span></div><div class="line">    <span class="built_in">NSInteger</span> offset = string.length &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>;</div><div class="line">    <span class="built_in">NSRange</span> resultRange = <span class="built_in">NSMakeRange</span>(range.location+offset, <span class="number">0</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (resultRange.location &gt; resultString.length) &#123;</div><div class="line">        resultRange = <span class="built_in">NSMakeRange</span>(resultString.length, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (string.length &gt; <span class="number">0</span> &amp;&amp; resultRange.location &gt; <span class="number">4</span> &amp;&amp; resultRange.location &lt;= resultString.length &amp;&amp; ([[resultString substringWithRange:<span class="built_in">NSMakeRange</span>(resultRange.location<span class="number">-1</span>, <span class="number">1</span>)] isEqualToString:<span class="string">@" "</span>])) &#123;</div><div class="line">        resultRange = <span class="built_in">NSMakeRange</span>(resultRange.location+<span class="number">1</span>, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">    [textField setSelectedRange:resultRange];</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…¶ä¸­<code>[textField setSelectedRange:resultRange]</code>æ–¹æ³•ä¸æ˜¯textFieldè‡ªå¸¦æ–¹æ³•ï¼ŒtextFieldçš„åŸæ–¹æ³•æ˜¯<code>setSelectedTextRange</code>ï¼ŒåŸæœ‰çš„UITextRangeå¹¶ä¸èƒ½è‡ªå®šä¹‰ä½ç½®ï¼Œæœ¬è´¨ä¸Šæ˜¯é€šè¿‡è‡ªå®šä¹‰NSRangeç„¶åè½¬æ¢æˆç›¸å¯¹åº”çš„UITextRangeå†è°ƒç”¨textFieldè‡ªå¸¦æ–¹æ³•æ¥å®ç°å…‰æ ‡çš„ä½ç½®è®¾å®šã€‚</p>
<h3 id="æ€»ç»“åŠæ‰©å±•"><a href="#æ€»ç»“åŠæ‰©å±•" class="headerlink" title="æ€»ç»“åŠæ‰©å±•"></a>æ€»ç»“åŠæ‰©å±•</h3><p>ä»¥ä¸Šæœ€ç»ˆæŠŠè¿™ä¸ªå°çš„éœ€æ±‚å®ç°ï¼Œbugä¹Ÿè§£å†³æ‰äº†ï¼Œæœ€ç»ˆä¸Šçº¿ç‰ˆæœ¬ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚ä½†ä¸Šçº¿åæˆ‘è§‰å¾—è¿™æ ·çš„å®ç°æ–¹å¼å¹¶ä¸å¥½ï¼Œå› ä¸ºæ¯æ¬¡æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼šæŸä¸ªtextFieldéœ€è¦æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæ¯4ä½æ’å…¥1ä¸ªç©ºæ ¼ï¼Œå°±éœ€è¦æŠŠè¿™æ®µä»£ç copyåˆ°delegateæ–¹æ³•ä¸‹é¢ï¼Œä»£ç é‡å¤ä¸è¯´è¿˜å®¹æ˜“å‡ºé”™ï¼Œå› ä¸ºå¾ˆæœ‰å¯èƒ½è¿™ä¸ªtextFieldå¹¶ä¸ä»…ä»…æœ‰è¿™1ç§æ ¼å¼ï¼Œè¿˜éœ€è¦è€ƒè™‘å¦‚æœtextFieldåœ¨æŸä¸ªTableViewCellçš„æ—¶å€™å…¶ä»–è¾“å…¥æºå¹¶ä¸éœ€è¦è¿™æ ·çš„æ ¼å¼åŒ–ï¼Œäºæ˜¯åˆè¦è®¾ç½®ä¸€äº›æ¡ä»¶ã€‚è¿™ä¸ªè¿‡ç¨‹å¾ˆç¹çã€‚</p>
<p>ç”±æ­¤æƒ³åˆ°èƒ½ä¸èƒ½é€šè¿‡ç»™textFieldæ·»åŠ categoryçš„æ–¹æ³•æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œè®¾ç½®1ä¸ªå¼€å…³ï¼Œéœ€è¦æ ¼å¼åŒ–çš„æ—¶å€™æ‰“å¼€ï¼Œä¸éœ€è¦å°±å…³é—­æˆ–ä¸æ‰“å¼€ã€‚</p>
<h4 id="æ‰©å±•ä¹‹è·¯"><a href="#æ‰©å±•ä¹‹è·¯" class="headerlink" title="æ‰©å±•ä¹‹è·¯"></a>æ‰©å±•ä¹‹è·¯</h4><p>é¦–å…ˆæƒ³åˆ°çš„æ˜¯ç›´æ¥æŠŠdelegateçš„ä»£ç copyåˆ°categoryé‡Œé¢ï¼Œåœ¨categoryé‡Œé¢å®ç°ä»£ç†æ–¹æ³•ï¼Œè¿™æ ·åšæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥æœ‰ä¸€äº›é™åˆ¶ï¼šä½¿ç”¨è¿™ä¸ªåŠŸèƒ½çš„textFieldå¦‚æœè‡ªå·±å†è®¾ç½®delegateæºï¼Œé‚£ä¹ˆæ ¼å¼åŒ–æ–¹æ³•ä¼šå¤±æ•ˆï¼Œå› ä¸ºcategoryé‡Œçš„delegateæºæ²¡æœ‰è¢«é‡‡ç”¨ã€‚åŒæ—¶è¿˜æœ‰ä¸€ä¸ªå°çš„ç¼ºæ†¾æ˜¯ï¼Œå¦‚æœè¯¥textFieldä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰é”®ç›˜DDKeyboardï¼Œç”±äºDDKeyboardåˆ é™¤é”®å¹¶ä¸è§¦å‘delegateæ–¹æ³•ï¼Œåˆ é™¤äº‹ä»¶æ˜¯ä¸èƒ½è¢«æ•è·çš„ï¼Œä¹Ÿå°±ä¸èƒ½æ­£ç¡®çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²(æ‰€ä»¥çº¿ä¸Šç‰ˆæœ¬å¹¶æ²¡æœ‰ä½¿ç”¨è‡ªå®šä¹‰é”®ç›˜)ã€‚</p>
<p>è¿™æ—¶å‚è€ƒäº†<code>WTReTextField</code>çš„åšæ³•ï¼Œé€šè¿‡ç›‘å¬textFieldçš„ç¼–è¾‘çŠ¶æ€<code>UIControlEventEditingChanged</code>æ¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚è¿™æ ·å°±æ’é™¤äº†delegateæºçš„å¹²æ‰°ï¼ŒåŒæ—¶è¿˜èƒ½æ”¯æ’‘è‡ªå®šä¹‰é”®ç›˜çš„ä½¿ç”¨ã€‚è¿™ä¸ªå®ç°è¿‡ç¨‹ç›¸å¯¹æ¯”è¾ƒé¡ºåˆ©ï¼Œä½†ä¹Ÿæœ‰äº›é—®é¢˜æ¯”è¾ƒè€—æ—¶ï¼š</p>
<h5 id="å¦‚ä½•åˆ¤æ–­æŸæ¬¡ç¼–è¾‘æ˜¯åˆ é™¤è¿˜æ˜¯è¾“å…¥ï¼Œè¿™ä¸ªæ¡ä»¶ä¼šå½±å“å…‰æ ‡æœ€ç»ˆçš„ä½ç½®ã€‚"><a href="#å¦‚ä½•åˆ¤æ–­æŸæ¬¡ç¼–è¾‘æ˜¯åˆ é™¤è¿˜æ˜¯è¾“å…¥ï¼Œè¿™ä¸ªæ¡ä»¶ä¼šå½±å“å…‰æ ‡æœ€ç»ˆçš„ä½ç½®ã€‚" class="headerlink" title="å¦‚ä½•åˆ¤æ–­æŸæ¬¡ç¼–è¾‘æ˜¯åˆ é™¤è¿˜æ˜¯è¾“å…¥ï¼Œè¿™ä¸ªæ¡ä»¶ä¼šå½±å“å…‰æ ‡æœ€ç»ˆçš„ä½ç½®ã€‚"></a>å¦‚ä½•åˆ¤æ–­æŸæ¬¡ç¼–è¾‘æ˜¯åˆ é™¤è¿˜æ˜¯è¾“å…¥ï¼Œè¿™ä¸ªæ¡ä»¶ä¼šå½±å“å…‰æ ‡æœ€ç»ˆçš„ä½ç½®ã€‚</h5><p>æˆ‘çš„è§£å†³æ–¹æ³•æ˜¯ï¼Œè®°å½•textFieldå€¼å˜åŒ–ä¹‹å<code>UIControlEventValueChanged</code>çš„å­—ç¬¦ä¸²ï¼Œç„¶åä¸‹æ¬¡ç¼–è¾‘æ—¶æ¯”è¾ƒä¸€ä¸‹ä¸Šæ¬¡è®°å½•çš„å­—ç¬¦ä¸²å’Œå½“å‰çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœå½“å‰å­—ç¬¦ä¸²æ¯”è¾ƒé•¿ï¼Œé‚£æ¡£æ¬¡ç¼–è¾‘å°±æ˜¯è¾“å…¥ï¼Œåä¹‹åˆ™æ˜¯åˆ é™¤ã€‚</p>
<h5 id="å…‰æ ‡ä½ç½®çš„è®¡ç®—"><a href="#å…‰æ ‡ä½ç½®çš„è®¡ç®—" class="headerlink" title="å…‰æ ‡ä½ç½®çš„è®¡ç®—"></a>å…‰æ ‡ä½ç½®çš„è®¡ç®—</h5><p>ä¹‹å‰åœ¨delegateæ–¹æ³•é‡Œé¢å®ç°çš„æ—¶å€™ï¼Œå…‰æ ‡çš„ä½ç½®å¯ä»¥é€šè¿‡delegateä¼ è¿‡æ¥çš„<code>range</code>å¾—åˆ°ï¼Œæ”¹ç”±äº‹ä»¶ç›‘å¬æ–¹æ³•ä¹‹åï¼Œå…‰æ ‡ä½ç½®å°±åªèƒ½é€šè¿‡<code>UITextRange *selectedRange = textField;</code>æ¥å¾—åˆ°äº†ï¼Œä½†æ˜¯è¿™ä¸ª<code>range</code>å’Œdelegateæ–¹æ³•é‡Œçš„<code>range</code>æ˜¯æœ‰åŒºåˆ«çš„ï¼Œå‰è€…å¾—åˆ°çš„æ˜¯æœ¬æ¬¡ç¼–è¾‘ä¹‹åçš„rangeï¼Œåè€…å¾—åˆ°çš„æ˜¯æœ¬æ¬¡ç¼–è¾‘ä¹‹å‰çš„rangeã€‚æ‰€ä»¥å…‰æ ‡ä½ç½®éœ€è¦é‡æ–°è®¡ç®—ã€‚</p>
<p>ç”±äºäº‹ä»¶ç›‘å¬æ–¹æ¡ˆå¾—åˆ°çš„<code>range</code>æ˜¯ç¼–è¾‘ä¹‹åçš„rangeï¼Œæ‰€ä»¥å…¶å®éœ€è¦è€ƒè™‘çš„å…‰æ ‡ä½ç½®çš„ä»…æ˜¯ä¸€äº›ä¾‹å¤–ï¼šæ’å…¥ç©ºæ ¼ä¹‹åå…‰æ ‡ä½ç½®éœ€è¦å‘åé¢å¤–ç§»åŠ¨1ä½ï¼Œå¦‚ï¼š<code>1234| 6789</code>å…‰æ ‡åœ¨4åé¢<code>NSRange(4,0)</code>ï¼Œè¿™æ˜¯å¦‚æœè¾“å…¥5ï¼Œé‚£ä¹ˆç»“æœåº”è¯¥æ˜¯<code>1234 5|678 9</code>ï¼Œå…‰æ ‡ä½ç½®æ˜¯<code>NSRange(6,0)</code>ï¼Œè¿™æ—¶ç³»ç»Ÿæ–¹æ³•è®°å½•çš„å…‰æ ‡ä½ç½®å…¶å®æ˜¯<code>NSRange(6,0)</code>ï¼Œå› ä¸ºå®ƒå¹¶ä¸çŸ¥é“ä½ åœ¨5ä¹‹å‰æ’å…¥äº†ä¸€ä¸ªç©ºæ ¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæ˜¯å¦æ’å…¥ç©ºæ ¼çš„æ¡ä»¶æ€æ ·æ¥åˆ¤æ–­å‘¢ï¼Ÿ</p>
<p>æœ€åæˆ‘çš„è§£å†³æ–¹æ³•æ˜¯ï¼šåˆ¤æ–­è¾“å…¥ä¹‹å‰å…‰æ ‡çš„ä½ç½®å‰é¢çš„4ä½å­—ç¬¦æ˜¯å¦å«æœ‰ç©ºæ ¼ï¼Œå¦‚æœæ²¡æœ‰ç©ºæ ¼é‚£å°±å¯ä»¥æ–­å®šå…‰æ ‡æ‰€åœ¨çš„ä½ç½®æ˜¯éœ€è¦æ’å…¥ç©ºæ ¼çš„ï¼Œå…‰æ ‡çš„ä½ç½®ç›¸åº”çš„éœ€è¦å‘åç§»åŠ¨1ä½ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  å¦‚æœæœ¬æ¬¡ç¼–è¾‘æ˜¯è¾“å…¥è€Œä¸æ˜¯åˆ é™¤ï¼Œå¹¶ä¸”è¾“å…¥ä¹‹å‰å…‰æ ‡çš„ä½ç½®åœ¨æŸæ®µ4ä½å·ç çš„å°¾éƒ¨ï¼Œåˆ™å…‰æ ‡ç›¸åº”çš„éœ€è¦å‘åç§»åŠ¨ä¸€ä½(ç©ºæ ¼å½±å“)</span></div><div class="line"><span class="keyword">if</span> (textAfterAction.length &gt; textBeforeAction.length &amp;&amp; range.location &gt; <span class="number">4</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (range.location - <span class="number">1</span> &lt;= textBeforeAction.length) &#123;</div><div class="line">        <span class="built_in">NSString</span> *formerString = [textBeforeAction substringWithRange:<span class="built_in">NSMakeRange</span>(range.location<span class="number">-5</span>, <span class="number">4</span>)];</div><div class="line">        <span class="keyword">if</span> (![formerString containsString:<span class="string">@" "</span>]) &#123;</div><div class="line">            range = <span class="built_in">NSMakeRange</span>(range.location + <span class="number">1</span>, <span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è‡³æ­¤categoryçš„å®ç°æ–¹æ¡ˆæœ€ç»ˆå®Œæˆï¼Œcategoryçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<p><code>UITextField+customFormat.h</code>æ–‡ä»¶</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UITextField</span> (<span class="title">customFormat</span>)</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setHasSpaceEveryFourDigits:(<span class="built_in">BOOL</span>)flag;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p><code>UITextField+customFormat.m</code>æ–‡ä»¶</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"UITextField+customFormat.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">char</span> *kPropertyTextBeforeEditing;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UITextField</span>()&lt;<span class="title">UITextFieldDelegate</span>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *textBeforeEditing;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UITextField</span> (<span class="title">customFormat</span>)</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setTextBeforeEditing:(<span class="built_in">NSString</span> *)textBeforeEditing</div><div class="line">&#123;</div><div class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, &amp;kPropertyTextBeforeEditing, textBeforeEditing, OBJC_ASSOCIATION_COPY);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSString</span> *)textBeforeEditing</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, &amp;kPropertyTextBeforeEditing);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - outer reference</span></div><div class="line">- (<span class="keyword">void</span>)setHasSpaceEveryFourDigits:(<span class="built_in">BOOL</span>)flag;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (flag) &#123;</div><div class="line">        [<span class="keyword">self</span> addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(valueDidChanged) forControlEvents:<span class="built_in">UIControlEventValueChanged</span>];</div><div class="line">        [<span class="keyword">self</span> addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(editingChanged) forControlEvents:<span class="built_in">UIControlEventEditingChanged</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        [<span class="keyword">self</span> removeTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(valueDidChanged) forControlEvents:<span class="built_in">UIControlEventValueChanged</span>];</div><div class="line">        [<span class="keyword">self</span> removeTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(editingChanged) forControlEvents:<span class="built_in">UIControlEventEditingChanged</span>];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - handle event</span></div><div class="line"><span class="comment">//  è®°å½•ä¸Šæ¬¡ç¼–è¾‘ä¹‹åçš„å­—ç¬¦ä¸²</span></div><div class="line">- (<span class="keyword">void</span>)valueDidChanged</div><div class="line">&#123;</div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">        [<span class="keyword">self</span> setTextBeforeEditing:<span class="keyword">self</span>.text];</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//  æœ¬æ¬¡ç¼–è¾‘æ—¶è°ƒç”¨æ ¼å¼åŒ–æ–¹æ³•</span></div><div class="line">- (<span class="keyword">void</span>)editingChanged</div><div class="line">&#123;</div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">        [<span class="keyword">self</span> actionFormatString];</div><div class="line">        [<span class="keyword">self</span> sendActionsForControlEvents:<span class="built_in">UIControlEventValueChanged</span>];</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//	æ ¼å¼åŒ–å­—ç¬¦ä¸²å¹¶è®¾ç½®å…‰æ ‡ä½ç½®çš„æ–¹æ³•</span></div><div class="line">- (<span class="keyword">void</span>)actionFormatString</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSString</span> *textBeforeAction = <span class="keyword">self</span>.textBeforeEditing;</div><div class="line">    <span class="built_in">NSString</span> *textAfterAction = <span class="keyword">self</span>.text;</div><div class="line">    <span class="built_in">NSString</span> *textFormatted = [<span class="keyword">self</span> stringOfSpaceEveryFourDigitsFromOriginalString:textAfterAction];</div><div class="line">    </div><div class="line">    <span class="comment">//  è®°å½•ç¼–è¾‘è¿‡åçš„å…‰æ ‡ä½ç½®ï¼Œä¾›ä¸‹é¢è°ƒç”¨ï¼Œå› ä¸ºè°ƒç”¨è¿‡[setText]æ–¹æ³•ä¹‹åå…‰æ ‡ä½ç½®ä¼šè‡ªåŠ¨æ”¾åˆ°æœ«ä½ï¼›</span></div><div class="line">    <span class="built_in">NSRange</span> range = [<span class="keyword">self</span> selectedRange];</div><div class="line">    </div><div class="line">    <span class="comment">//  å¦‚æœæœ¬æ¬¡ç¼–è¾‘æ˜¯è¾“å…¥è€Œä¸æ˜¯åˆ é™¤ï¼Œå¹¶ä¸”è¾“å…¥ä¹‹å‰å…‰æ ‡çš„ä½ç½®åœ¨æŸæ®µ4ä½å·ç çš„å°¾éƒ¨ï¼Œåˆ™å…‰æ ‡ç›¸åº”çš„éœ€è¦å‘åç§»åŠ¨ä¸€ä½(ç©ºæ ¼å½±å“)ï¼›</span></div><div class="line">    <span class="keyword">if</span> (textAfterAction.length &gt; textBeforeAction.length &amp;&amp; range.location &gt; <span class="number">4</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (range.location - <span class="number">5</span> + <span class="number">4</span> &lt;= textBeforeAction.length) &#123;</div><div class="line">            <span class="built_in">NSString</span> *formerString = [textBeforeAction substringWithRange:<span class="built_in">NSMakeRange</span>(range.location<span class="number">-5</span>, <span class="number">4</span>)];</div><div class="line">            <span class="keyword">if</span> (![formerString containsString:<span class="string">@" "</span>]) &#123;</div><div class="line">                range = <span class="built_in">NSMakeRange</span>(range.location + <span class="number">1</span>, <span class="number">0</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//  å¦‚æœå…‰æ ‡çš„ä½ç½®è¶…è¿‡äº†å­—ç¬¦ä¸²é•¿åº¦ï¼Œè®¾ç½®å…‰æ ‡ä½ç½®åˆ°æœ«ä½(åˆ é™¤æ—¶ä¼šå‡ºç°è¿™ç§æƒ…å†µ)ï¼›</span></div><div class="line">    <span class="keyword">if</span> (range.location &gt; textFormatted.length) &#123;</div><div class="line">        range = <span class="built_in">NSMakeRange</span>(textFormatted.length, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//  è®¾ç½®æ ¼å¼åŒ–ä¹‹åçš„å­—ç¬¦ä¸²ï¼Œå°†å…‰æ ‡ç§»åˆ°æŒ‡å®šä½ç½®ï¼›</span></div><div class="line">    [<span class="keyword">self</span> setText:textFormatted];</div><div class="line">    [<span class="keyword">self</span> setSelectedRange:range];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - format string</span></div><div class="line">- (<span class="built_in">NSString</span> *)stringOfSpaceEveryFourDigitsFromOriginalString:(<span class="built_in">NSString</span> *)rawString</div><div class="line">&#123;</div><div class="line">    <span class="comment">//  å°†æºå­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼å…¨éƒ¨ç§»é™¤</span></div><div class="line">    <span class="built_in">NSString</span> *normalString = [rawString stringByReplacingOccurrencesOfString:<span class="string">@" "</span> withString:<span class="string">@""</span>];</div><div class="line">    <span class="built_in">NSMutableString</span> *resultString = [<span class="built_in">NSMutableString</span> stringWithString:normalString];</div><div class="line">    </div><div class="line">    <span class="comment">//  æ¯å››ä½æ’å…¥1ä¸ªç©ºæ ¼</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i=<span class="number">0</span>; i&lt;resultString.length/<span class="number">5</span>; i++) &#123;</div><div class="line">        [resultString insertString:<span class="string">@" "</span> atIndex:i*<span class="number">5</span>+<span class="number">4</span>];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> resultString;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - set textRange and get textRange</span></div><div class="line">- (<span class="keyword">void</span>) setSelectedRange:(<span class="built_in">NSRange</span>) range</div><div class="line">&#123;</div><div class="line">    <span class="built_in">UITextPosition</span> *beginning = <span class="keyword">self</span>.beginningOfDocument;</div><div class="line">    </div><div class="line">    <span class="built_in">UITextPosition</span> *startPosition = [<span class="keyword">self</span> positionFromPosition:beginning offset:range.location];</div><div class="line">    <span class="built_in">UITextPosition</span> *endPosition = [<span class="keyword">self</span> positionFromPosition:beginning offset:range.location + range.length];</div><div class="line">    <span class="built_in">UITextRange</span> *selectionRange = [<span class="keyword">self</span> textRangeFromPosition:startPosition toPosition:endPosition];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> setSelectedTextRange:selectionRange];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSRange</span>) selectedRange</div><div class="line">&#123;</div><div class="line">    <span class="built_in">UITextPosition</span>* beginning = <span class="keyword">self</span>.beginningOfDocument;</div><div class="line">    </div><div class="line">    <span class="built_in">UITextRange</span>* selectedRange = <span class="keyword">self</span>.selectedTextRange;</div><div class="line">    <span class="built_in">UITextPosition</span>* selectionStart = selectedRange.start;</div><div class="line">    <span class="built_in">UITextPosition</span>* selectionEnd = selectedRange.end;</div><div class="line">    </div><div class="line">    <span class="keyword">const</span> <span class="built_in">NSInteger</span> location = [<span class="keyword">self</span> offsetFromPosition:beginning toPosition:selectionStart];</div><div class="line">    <span class="keyword">const</span> <span class="built_in">NSInteger</span> length = [<span class="keyword">self</span> offsetFromPosition:selectionStart toPosition:selectionEnd];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="built_in">NSMakeRange</span>(location, length);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/blog/2016/12/29/UITextFieldå®ç°é“¶è¡Œå¡å·æ ¼å¼è¸©å‘è®°å½•/" class="archive-article-date">
  	<time datetime="2016-12-29T09:47:26.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-12-29</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>

  
<nav id="article-nav">
  
  
    <a href="/blog/2016/10/10/UITableViewIntro/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">UITableViewå¸¸ç”¨æ–¹æ³•ç®€ä»‹</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>










<section id="comments">
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'jslite'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 æ™¨æ˜Ÿã€é£
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: false,
		mathjax: false,
		animate: false,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/blog/",
		innerArchive: false
	}
</script>

<script src="/blog/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
    
    
      <li data-hook="tools-section-friends"><span class="text">å‹é“¾</span><i class="icon-link"></i></li>
    
    
  </ul>
  <div class="tools-wrap">
    

    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="https://developer.apple.com/news/">Apple Developer News</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="https://onevcat.com">Onevcatçš„åšå®¢</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.sunnyxx.com">Sunnyçš„åšå®¢</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.devtang.com">å”å·§çš„åšå®¢</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://kittenyang.com">æ¨éª‘æ»”çš„åšå®¢</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://ericasadun.com">Erica Sadunçš„åšå®¢</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="https://mikeash.com/pyblog/">Mike Ashçš„åšå®¢</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://jspahrsummers.com">ustin Spahr-Summersçš„åšå®¢</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://samvermette.com">Sam Vermetteçš„åšå®¢</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="https://ashfurrow.com">Ash Furrowçš„åšå®¢</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.jessesquires.com">Jesse Squiresçš„åšå®¢</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://tech.meituan.com">ç¾å›¢ç‚¹è¯„æŠ€æœ¯åšå®¢</a>
  	        
  	        </div>
  		
    	</section>
    

    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>