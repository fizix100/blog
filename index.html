<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>晨星_风的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="晨星_风的博客">
<meta property="og:url" content="http://yoursite.com/blog/index.html">
<meta property="og:site_name" content="晨星_风的博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="晨星_风的博客">
  
  
  <script src="/blog/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://oerkxd2a0.bkt.clouddn.com/zizhan/1476063479228.png" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">晨星、风</a></h1>
		</hgroup>

		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/blog/blog">主页</a></li>
	        
				<li><a href="/blog/archives">所有文章</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">友情链接</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="http://github.com/fizix100" title="github">github</a>
		        
					<a class="weibo" target="_blank" href="http://weibo.com/fizix100" title="weibo">weibo</a>
		        
					<a class="zhihu" target="_blank" href="http://zhihu.com/people/fizix100" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">晨星、风</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="/blog/http://oerkxd2a0.bkt.clouddn.com/zizhan/1476063479228.png" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
				
			</div>
			<hgroup>
			  <h1 class="header-author">晨星、风</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/blog/blog">主页</a></li>
		        
					<li><a href="/blog/archives">所有文章</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="http://github.com/fizix100" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/fizix100" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="http://zhihu.com/people/fizix100" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-UITextField实现银行卡号格式踩坑记录" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="UITextField实现银行卡号格式踩坑记录"><a href="#UITextField实现银行卡号格式踩坑记录" class="headerlink" title="UITextField实现银行卡号格式踩坑记录"></a><strong>UITextField实现银行卡号格式踩坑记录</strong></h2><p>上次接到一个“很小的需求”是UITextField输入的数字编号要每隔4位插入一个空格，乍一看好像很简单，只需要在textField的delegate方法(shouldChangeCharactersInRange)里面加一些简单的判断并插入空格即可，然而事实并不是这样，这个小小的需求隐藏了各种小坑；</p>
<h3 id="最简单的实现"><a href="#最简单的实现" class="headerlink" title="最简单的实现"></a>最简单的实现</h3><p>这个需求最直观的实现方式就是，在代理方法中加判断插入空格，代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)textField:(<span class="built_in">UITextField</span> *)textField shouldChangeCharactersInRange:(<span class="built_in">NSRange</span>)range replacementString:(<span class="built_in">NSString</span> *)string</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ((textField.text.length+<span class="number">1</span>) % <span class="number">5</span> == <span class="number">0</span> &amp;&amp; textField.text.length &gt; <span class="number">0</span> &amp;&amp; string.length &gt; <span class="number">0</span>) &#123;</div><div class="line">        textField.text = [textField.text stringByAppendingString:<span class="string">@" "</span>];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>经过各种简化提炼，将各种逻辑简化为1个if判断语句和一行插入空格的代码：条件有3个：①字符串的长度(不含空格)可以被4整除；②字符串的长度大于0；③本次编辑是输入动作。以上代码可以满足最基本的需求，字符的输出格式一般不会出错😎。然而残酷的现实告诉你这个需求真的没这么简单！！！</p>
<h3 id="测试的无情鞭挞"><a href="#测试的无情鞭挞" class="headerlink" title="测试的无情鞭挞"></a>测试的无情鞭挞</h3><p>以上代码简单清晰，貌似很完美，但也仅仅是貌似。这个简单的逻辑判断的完美表现有一个前提条件：用户不会手动去移动光标，仅按字符输入键或删除键来输入或删除字符。此时主要有2个bug：①光标不在末尾的时候上面的插入空格逻辑会失效，因为判断逻辑虽然没错，但是输入或删除字符的位置变掉了，实际输出的字符就会乱掉。②因为<code>textField.text = xxx;</code>这行赋值代码运行之后会自动将光标移动到textField的末尾，所以如果用户的光标不在末尾，输入或删除某个字符之后光标将移动到末尾😂，用户表示一脸懵逼😳。</p>
<p>###解bug的试炼</p>
<h4 id="先看第一个bug，空格插入的位置会出错，那么我们要如何解决呢："><a href="#先看第一个bug，空格插入的位置会出错，那么我们要如何解决呢：" class="headerlink" title="先看第一个bug，空格插入的位置会出错，那么我们要如何解决呢："></a>先看第一个bug，空格插入的位置会出错，那么我们要如何解决呢：</h4><p>先判断一下光标位置，然后看用户当前按的是删除键还是输入字符键，来判断当前是否需要插入空格？<br>这个判断条件比较繁琐，不仅需要判断当前的光标位置是否需要插入字符串，而且要考虑插或者不插入空格以及在输入/删除某个字符时候整体字符串的格式需要变更的问题，例如：<code>1234 |5678</code>，光标在5之前，空格之后，此时输入一个字符9的话，需要插入空格的位置是在7和8之间，为<code>1234 9|567 8</code>，这还是字符串比较短的情况，如果字符串比较长，还要考虑后面每1个空格的删除及插入。这条路应该是有解的，但是可能需要走过山路18弯，对于还有1天就要提测的我来说，真心绕不起🤥。</p>
<p>没想到这么个小需求隐藏着这样的坑，此刻我的心情是哇凉哇凉的😰。</p>
<h4 id="既然第一个bug暂时没有好的解决方法，那能不能先解决第二个呢？"><a href="#既然第一个bug暂时没有好的解决方法，那能不能先解决第二个呢？" class="headerlink" title="既然第一个bug暂时没有好的解决方法，那能不能先解决第二个呢？"></a>既然第一个bug暂时没有好的解决方法，那能不能先解决第二个呢？</h4><p>第二个bug源自于<code>textField.text = xxx;</code>这行代码，对textField赋值之后光标自动移动到末尾，那么是否可以记录一下赋值之前的光标位置，赋值之后再将光标放回去呢？于是代码改成这样：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ((textField.text.length+<span class="number">1</span>) % <span class="number">5</span> == <span class="number">0</span> &amp;&amp; textField.text.length &gt; <span class="number">0</span> &amp;&amp; string.length &gt; <span class="number">0</span>) </div><div class="line">&#123;</div><div class="line">	<span class="built_in">UITextRange</span> *textRange = textField.selectedTextRange;</div><div class="line">	textField.text = [textField.text stringByAppendingString:<span class="string">@" "</span>];</div><div class="line">    textField.selectedTextRange = textRange;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行之后发现空格都不插入了，这尼玛什么鬼，然后就发现原来是因为把光标还原到原来的位置之后编辑的位置也变成了插入空格之前的位置，因此空格没有插入😓。</p>
<p>于是就陷入了bug的汪洋大海之中，你这样解决它就那样冒出来，你那样解决它就这样冒出来😶</p>
<h4 id="换一种思路来解决"><a href="#换一种思路来解决" class="headerlink" title="换一种思路来解决"></a>换一种思路来解决</h4><p>既然用户的输入位置不可控，输入之后是否插入空格也需要由条件而定，输入之后光标的位置也不可控，那么什么是可控的？用户输入/删除之后的字符串(不包含空格)，这个是可控的。而其他的不可控因素都依赖于编辑之后的字符串。那么我们直接通过编辑之后的字符串来找答案：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)textField:(<span class="built_in">UITextField</span> *)textField shouldChangeCharactersInRange:(<span class="built_in">NSRange</span>)range replacementString:(<span class="built_in">NSString</span> *)string</div><div class="line">&#123;</div><div class="line">    <span class="comment">//  编辑之后的字符串</span></div><div class="line">    <span class="built_in">NSMutableString</span> *resultString = [<span class="built_in">NSMutableString</span> stringWithString:textField.text];</div><div class="line">    [resultString replaceCharactersInRange:range withString:string];</div><div class="line">    </div><div class="line">    <span class="comment">//  先去除空格</span></div><div class="line">    <span class="built_in">NSString</span> *noSpaceString = [resultString stringByReplacingOccurrencesOfString:<span class="string">@" "</span> withString:<span class="string">@""</span>];</div><div class="line">    resultString = [<span class="built_in">NSMutableString</span> stringWithString:noSpaceString];</div><div class="line">    </div><div class="line">    <span class="comment">//  每四位插入1个空格</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i=<span class="number">0</span>; i&lt;resultString.length/<span class="number">5</span>; i++) &#123;</div><div class="line">        [resultString insertString:<span class="string">@" "</span> atIndex:i*<span class="number">5</span>+<span class="number">4</span>];</div><div class="line">    &#125;</div><div class="line">    textField.text = resultString;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上代码可以编辑之后的字符串格式不会出错，每隔4位插入1个空格，因为输入源是固定的。但是还遗留有1个问题就是通过<code>textField.text = resultString</code>赋值之后的光标位置一定是在末尾，影响用户体验。这个bug的解决思路还是在上面那一步，即先记录赋值之前光标的位置，赋值之后再将光标移动到之前的位置，只是代码不是简单的2行了，而需要考虑编辑之后光标位置的变化：如果是删除，光标的违章会向前移动；如果是输入，光标会向后移动1位，如果同时又空格插入，则光标需要向后移动2位；于是代码变成了下面的：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)textField:(<span class="built_in">UITextField</span> *)textField shouldChangeCharactersInRange:(<span class="built_in">NSRange</span>)range replacementString:(<span class="built_in">NSString</span> *)string</div><div class="line">&#123;</div><div class="line">    <span class="comment">//  编辑之后的字符串</span></div><div class="line">    <span class="built_in">NSMutableString</span> *resultString = [<span class="built_in">NSMutableString</span> stringWithString:textField.text];</div><div class="line">    [resultString replaceCharactersInRange:range withString:string];</div><div class="line">    </div><div class="line">    <span class="comment">//  先去除空格</span></div><div class="line">    <span class="built_in">NSString</span> *noSpaceString = [resultString stringByReplacingOccurrencesOfString:<span class="string">@" "</span> withString:<span class="string">@""</span>];</div><div class="line">    resultString = [<span class="built_in">NSMutableString</span> stringWithString:noSpaceString];</div><div class="line">    </div><div class="line">    <span class="comment">//  每四位插入1个空格</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i=<span class="number">0</span>; i&lt;resultString.length/<span class="number">5</span>; i++) &#123;</div><div class="line">        [resultString insertString:<span class="string">@" "</span> atIndex:i*<span class="number">5</span>+<span class="number">4</span>];</div><div class="line">    &#125;</div><div class="line">    textField.text = resultString;</div><div class="line">    </div><div class="line">    <span class="comment">//  计算光标位置并赋值</span></div><div class="line">    <span class="built_in">NSInteger</span> offset = string.length &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>;</div><div class="line">    <span class="built_in">NSRange</span> resultRange = <span class="built_in">NSMakeRange</span>(range.location+offset, <span class="number">0</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (resultRange.location &gt; resultString.length) &#123;</div><div class="line">        resultRange = <span class="built_in">NSMakeRange</span>(resultString.length, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (string.length &gt; <span class="number">0</span> &amp;&amp; resultRange.location &gt; <span class="number">4</span> &amp;&amp; resultRange.location &lt;= resultString.length &amp;&amp; ([[resultString substringWithRange:<span class="built_in">NSMakeRange</span>(resultRange.location<span class="number">-1</span>, <span class="number">1</span>)] isEqualToString:<span class="string">@" "</span>])) &#123;</div><div class="line">        resultRange = <span class="built_in">NSMakeRange</span>(resultRange.location+<span class="number">1</span>, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">    [textField setSelectedRange:resultRange];</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中<code>[textField setSelectedRange:resultRange]</code>方法不是textField自带方法，textField的原方法是<code>setSelectedTextRange</code>，原有的UITextRange并不能自定义位置，本质上是通过自定义NSRange然后转换成相对应的UITextRange再调用textField自带方法来实现光标的位置设定。</p>
<h3 id="总结及扩展"><a href="#总结及扩展" class="headerlink" title="总结及扩展"></a>总结及扩展</h3><p>以上最终把这个小的需求实现，bug也解决掉了，最终上线版本也是这样的。但上线后我觉得这样的实现方式并不好，因为每次有这样一个需求：某个textField需要格式化字符串，每4位插入1个空格，就需要把这段代码copy到delegate方法下面，代码重复不说还容易出错，因为很有可能这个textField并不仅仅有这1种格式，还需要考虑如果textField在某个TableViewCell的时候其他输入源并不需要这样的格式化，于是又要设置一些条件。这个过程很繁琐。</p>
<p>由此想到能不能通过给textField添加category的方法来实现这个功能，设置1个开关，需要格式化的时候打开，不需要就关闭或不打开。</p>
<h4 id="扩展之路"><a href="#扩展之路" class="headerlink" title="扩展之路"></a>扩展之路</h4><p>首先想到的是直接把delegate的代码copy到category里面，在category里面实现代理方法，这样做是可行的，但是使用起来有一些限制：使用这个功能的textField如果自己再设置delegate源，那么格式化方法会失效，因为category里的delegate源没有被采用。同时还有一个小的缺憾是，如果该textField使用的是自定义键盘DDKeyboard，由于DDKeyboard删除键并不触发delegate方法，删除事件是不能被捕获的，也就不能正确的格式化字符串(所以线上版本并没有使用自定义键盘)。</p>
<p>这时参考了<code>WTReTextField</code>的做法，通过监听textField的编辑状态<code>UIControlEventEditingChanged</code>来格式化字符串。这样就排除了delegate源的干扰，同时还能支撑自定义键盘的使用。这个实现过程相对比较顺利，但也有些问题比较耗时：</p>
<h5 id="如何判断某次编辑是删除还是输入，这个条件会影响光标最终的位置。"><a href="#如何判断某次编辑是删除还是输入，这个条件会影响光标最终的位置。" class="headerlink" title="如何判断某次编辑是删除还是输入，这个条件会影响光标最终的位置。"></a>如何判断某次编辑是删除还是输入，这个条件会影响光标最终的位置。</h5><p>我的解决方法是，记录textField值变化之后<code>UIControlEventValueChanged</code>的字符串，然后下次编辑时比较一下上次记录的字符串和当前的字符串，如果当前字符串比较长，那档次编辑就是输入，反之则是删除。</p>
<h5 id="光标位置的计算"><a href="#光标位置的计算" class="headerlink" title="光标位置的计算"></a>光标位置的计算</h5><p>之前在delegate方法里面实现的时候，光标的位置可以通过delegate传过来的<code>range</code>得到，改由事件监听方法之后，光标位置就只能通过<code>UITextRange *selectedRange = textField;</code>来得到了，但是这个<code>range</code>和delegate方法里的<code>range</code>是有区别的，前者得到的是本次编辑之后的range，后者得到的是本次编辑之前的range。所以光标位置需要重新计算。</p>
<p>由于事件监听方案得到的<code>range</code>是编辑之后的range，所以其实需要考虑的光标位置的仅是一些例外：插入空格之后光标位置需要向后额外移动1位，如：<code>1234| 6789</code>光标在4后面<code>NSRange(4,0)</code>，这是如果输入5，那么结果应该是<code>1234 5|678 9</code>，光标位置是<code>NSRange(6,0)</code>，这时系统方法记录的光标位置其实是<code>NSRange(6,0)</code>，因为它并不知道你在5之前插入了一个空格，那么这个是否插入空格的条件怎样来判断呢？</p>
<p>最后我的解决方法是：判断输入之前光标的位置前面的4位字符是否含有空格，如果没有空格那就可以断定光标所在的位置是需要插入空格的，光标的位置相应的需要向后移动1位，代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  如果本次编辑是输入而不是删除，并且输入之前光标的位置在某段4位号码的尾部，则光标相应的需要向后移动一位(空格影响)</span></div><div class="line"><span class="keyword">if</span> (textAfterAction.length &gt; textBeforeAction.length &amp;&amp; range.location &gt; <span class="number">4</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (range.location - <span class="number">1</span> &lt;= textBeforeAction.length) &#123;</div><div class="line">        <span class="built_in">NSString</span> *formerString = [textBeforeAction substringWithRange:<span class="built_in">NSMakeRange</span>(range.location<span class="number">-5</span>, <span class="number">4</span>)];</div><div class="line">        <span class="keyword">if</span> (![formerString containsString:<span class="string">@" "</span>]) &#123;</div><div class="line">            range = <span class="built_in">NSMakeRange</span>(range.location + <span class="number">1</span>, <span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>至此category的实现方案最终完成，category的代码如下：</p>
<p><code>UITextField+customFormat.h</code>文件</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UITextField</span> (<span class="title">customFormat</span>)</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setHasSpaceEveryFourDigits:(<span class="built_in">BOOL</span>)flag;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p><code>UITextField+customFormat.m</code>文件</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"UITextField+customFormat.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">char</span> *kPropertyTextBeforeEditing;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UITextField</span>()&lt;<span class="title">UITextFieldDelegate</span>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *textBeforeEditing;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UITextField</span> (<span class="title">customFormat</span>)</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setTextBeforeEditing:(<span class="built_in">NSString</span> *)textBeforeEditing</div><div class="line">&#123;</div><div class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, &amp;kPropertyTextBeforeEditing, textBeforeEditing, OBJC_ASSOCIATION_COPY);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSString</span> *)textBeforeEditing</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, &amp;kPropertyTextBeforeEditing);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - outer reference</span></div><div class="line">- (<span class="keyword">void</span>)setHasSpaceEveryFourDigits:(<span class="built_in">BOOL</span>)flag;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (flag) &#123;</div><div class="line">        [<span class="keyword">self</span> addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(valueDidChanged) forControlEvents:<span class="built_in">UIControlEventValueChanged</span>];</div><div class="line">        [<span class="keyword">self</span> addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(editingChanged) forControlEvents:<span class="built_in">UIControlEventEditingChanged</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        [<span class="keyword">self</span> removeTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(valueDidChanged) forControlEvents:<span class="built_in">UIControlEventValueChanged</span>];</div><div class="line">        [<span class="keyword">self</span> removeTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(editingChanged) forControlEvents:<span class="built_in">UIControlEventEditingChanged</span>];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - handle event</span></div><div class="line"><span class="comment">//  记录上次编辑之后的字符串</span></div><div class="line">- (<span class="keyword">void</span>)valueDidChanged</div><div class="line">&#123;</div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">        [<span class="keyword">self</span> setTextBeforeEditing:<span class="keyword">self</span>.text];</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//  本次编辑时调用格式化方法</span></div><div class="line">- (<span class="keyword">void</span>)editingChanged</div><div class="line">&#123;</div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">        [<span class="keyword">self</span> actionFormatString];</div><div class="line">        [<span class="keyword">self</span> sendActionsForControlEvents:<span class="built_in">UIControlEventValueChanged</span>];</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//	格式化字符串并设置光标位置的方法</span></div><div class="line">- (<span class="keyword">void</span>)actionFormatString</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSString</span> *textBeforeAction = <span class="keyword">self</span>.textBeforeEditing;</div><div class="line">    <span class="built_in">NSString</span> *textAfterAction = <span class="keyword">self</span>.text;</div><div class="line">    <span class="built_in">NSString</span> *textFormatted = [<span class="keyword">self</span> stringOfSpaceEveryFourDigitsFromOriginalString:textAfterAction];</div><div class="line">    </div><div class="line">    <span class="comment">//  记录编辑过后的光标位置，供下面调用，因为调用过[setText]方法之后光标位置会自动放到末位；</span></div><div class="line">    <span class="built_in">NSRange</span> range = [<span class="keyword">self</span> selectedRange];</div><div class="line">    </div><div class="line">    <span class="comment">//  如果本次编辑是输入而不是删除，并且输入之前光标的位置在某段4位号码的尾部，则光标相应的需要向后移动一位(空格影响)；</span></div><div class="line">    <span class="keyword">if</span> (textAfterAction.length &gt; textBeforeAction.length &amp;&amp; range.location &gt; <span class="number">4</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (range.location - <span class="number">5</span> + <span class="number">4</span> &lt;= textBeforeAction.length) &#123;</div><div class="line">            <span class="built_in">NSString</span> *formerString = [textBeforeAction substringWithRange:<span class="built_in">NSMakeRange</span>(range.location<span class="number">-5</span>, <span class="number">4</span>)];</div><div class="line">            <span class="keyword">if</span> (![formerString containsString:<span class="string">@" "</span>]) &#123;</div><div class="line">                range = <span class="built_in">NSMakeRange</span>(range.location + <span class="number">1</span>, <span class="number">0</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//  如果光标的位置超过了字符串长度，设置光标位置到末位(删除时会出现这种情况)；</span></div><div class="line">    <span class="keyword">if</span> (range.location &gt; textFormatted.length) &#123;</div><div class="line">        range = <span class="built_in">NSMakeRange</span>(textFormatted.length, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//  设置格式化之后的字符串，将光标移到指定位置；</span></div><div class="line">    [<span class="keyword">self</span> setText:textFormatted];</div><div class="line">    [<span class="keyword">self</span> setSelectedRange:range];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - format string</span></div><div class="line">- (<span class="built_in">NSString</span> *)stringOfSpaceEveryFourDigitsFromOriginalString:(<span class="built_in">NSString</span> *)rawString</div><div class="line">&#123;</div><div class="line">    <span class="comment">//  将源字符串中的空格全部移除</span></div><div class="line">    <span class="built_in">NSString</span> *normalString = [rawString stringByReplacingOccurrencesOfString:<span class="string">@" "</span> withString:<span class="string">@""</span>];</div><div class="line">    <span class="built_in">NSMutableString</span> *resultString = [<span class="built_in">NSMutableString</span> stringWithString:normalString];</div><div class="line">    </div><div class="line">    <span class="comment">//  每四位插入1个空格</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i=<span class="number">0</span>; i&lt;resultString.length/<span class="number">5</span>; i++) &#123;</div><div class="line">        [resultString insertString:<span class="string">@" "</span> atIndex:i*<span class="number">5</span>+<span class="number">4</span>];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> resultString;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - set textRange and get textRange</span></div><div class="line">- (<span class="keyword">void</span>) setSelectedRange:(<span class="built_in">NSRange</span>) range</div><div class="line">&#123;</div><div class="line">    <span class="built_in">UITextPosition</span> *beginning = <span class="keyword">self</span>.beginningOfDocument;</div><div class="line">    </div><div class="line">    <span class="built_in">UITextPosition</span> *startPosition = [<span class="keyword">self</span> positionFromPosition:beginning offset:range.location];</div><div class="line">    <span class="built_in">UITextPosition</span> *endPosition = [<span class="keyword">self</span> positionFromPosition:beginning offset:range.location + range.length];</div><div class="line">    <span class="built_in">UITextRange</span> *selectionRange = [<span class="keyword">self</span> textRangeFromPosition:startPosition toPosition:endPosition];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> setSelectedTextRange:selectionRange];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSRange</span>) selectedRange</div><div class="line">&#123;</div><div class="line">    <span class="built_in">UITextPosition</span>* beginning = <span class="keyword">self</span>.beginningOfDocument;</div><div class="line">    </div><div class="line">    <span class="built_in">UITextRange</span>* selectedRange = <span class="keyword">self</span>.selectedTextRange;</div><div class="line">    <span class="built_in">UITextPosition</span>* selectionStart = selectedRange.start;</div><div class="line">    <span class="built_in">UITextPosition</span>* selectionEnd = selectedRange.end;</div><div class="line">    </div><div class="line">    <span class="keyword">const</span> <span class="built_in">NSInteger</span> location = [<span class="keyword">self</span> offsetFromPosition:beginning toPosition:selectionStart];</div><div class="line">    <span class="keyword">const</span> <span class="built_in">NSInteger</span> length = [<span class="keyword">self</span> offsetFromPosition:selectionStart toPosition:selectionEnd];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="built_in">NSMakeRange</span>(location, length);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/blog/2016/12/29/UITextField实现银行卡号格式踩坑记录/" class="archive-article-date">
  	<time datetime="2016-12-29T09:47:26.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-12-29</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-UITableViewIntro" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/10/10/UITableViewIntro/">UITableView常用方法简介</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>UITableView是iOS开发必不可少也是最重要的一个控件类之一。iOS开发者都需要熟练使用和掌握它。本文主要介绍一下UITableView的一些常用方法。</p>
<blockquote>
<p>UITableView 的官方文档：<a href="https://developer.apple.com/reference/uikit/uitableview?language=objc" target="_blank" rel="external">Apple开发者文档</a></p>
</blockquote>
<h5 id="1-初始化-UITableView对象"><a href="#1-初始化-UITableView对象" class="headerlink" title="1) 初始化 UITableView对象"></a>1) 初始化 UITableView对象</h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">initWithFrame:style:	<span class="comment">//初始化方法，用xib的话不需要调用</span></div></pre></td></tr></table></figure>
<h5 id="2-配置TableView"><a href="#2-配置TableView" class="headerlink" title="2)配置TableView"></a>2)配置TableView</h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">style <span class="comment">// 有两种 UITableViewStylePlain,UITableViewStyleGrouped</span></div><div class="line">numberOfRowsInSection:  <span class="comment">// section内row的数量</span></div><div class="line">numberOfSections  <span class="comment">// section数量</span></div><div class="line">rowHeight <span class="comment">// 行高，固定行高可用，性能比delegate方法好 </span></div><div class="line">separatorStyle <span class="comment">// cell分割线风格</span></div><div class="line">separatorColor <span class="comment">// cell分割线颜色 </span></div><div class="line">backgroundView <span class="comment">// tableview的背景view, 这个背景view在所有cell, header views, footer views之后 </span></div><div class="line">tableHeaderView <span class="comment">// tableview上方的headerView</span></div><div class="line">tableFooterView <span class="comment">// tableview下方的footerview </span></div><div class="line">sectionHeaderHeight <span class="comment">// section Header的高度， </span></div><div class="line">sectionFooterHeight <span class="comment">// section Footer的高度 </span></div><div class="line">sectionIndexMinimumDisplayRowCount <span class="comment">//  在tableview右侧展示索引的最小行数要求</span></div></pre></td></tr></table></figure>
<h5 id="3）-访问Cells和Sections"><a href="#3）-访问Cells和Sections" class="headerlink" title="3） 访问Cells和Sections"></a>3） 访问Cells和Sections</h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">– cellForRowAtIndexPath: <span class="comment">//根据IndexPath返回cell </span></div><div class="line">– indexPathForCell: <span class="comment">//根据cell返回它的indexPath,和上面的方法互补 </span></div><div class="line">– indexPathForRowAtPoint:<span class="comment">//根据一个几何点返回indexPath,如果超过边界返回nil </span></div><div class="line">– indexPathsForRowsInRect: <span class="comment">//根据一个几何的矩形返回矩形所覆盖的行,返回是一个indexPath数组 </span></div><div class="line">– visibleCells <span class="comment">// 当前视图下可见cell</span></div><div class="line">– indexPathsForVisibleRows <span class="comment">// 当前视图下可见cell的序列</span></div></pre></td></tr></table></figure>
<h5 id="4-滚动TableView"><a href="#4-滚动TableView" class="headerlink" title="4) 滚动TableView"></a>4) 滚动TableView</h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">– scrollToRowAtIndexPath:atScrollPosition:animated: <span class="comment">// 滚动到指定位置 </span></div><div class="line">– scrollToNearestSelectedRowAtScrollPosition:animated: <span class="comment">// 同上</span></div></pre></td></tr></table></figure>
<h5 id="5-管理sections"><a href="#5-管理sections" class="headerlink" title="5) 管理sections"></a>5) 管理sections</h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">– indexPathForSelectedRow <span class="comment">//返回选定行的indexPath,单行 </span></div><div class="line">– indexPathsForSelectedRows <span class="comment">//返回选定行的indexPath数组，多行 </span></div><div class="line">– selectRowAtIndexPath:animated:scrollPosition: <span class="comment">//根据indexPath选择一行 </span></div><div class="line">– deselectRowAtIndexPath:animated: <span class="comment">//反选一行，有何用？ </span></div><div class="line">  allowsSelection <span class="comment">//是否允许用户选取一行 </span></div><div class="line">  allowsMultipleSelection <span class="comment">// 是否选取多行，缺省为NO. 可以试试YES后的效果，哈哈 </span></div><div class="line">  allowsSelectionDuringEditing <span class="comment">// 编辑模式时是否可选取一行 </span></div><div class="line">  allowsMultipleSelectionDuringEditing <span class="comment">// 编辑模式时可否选取多行</span></div></pre></td></tr></table></figure>
<h5 id="6-插入、删除、移动行和sections"><a href="#6-插入、删除、移动行和sections" class="headerlink" title="6) 插入、删除、移动行和sections"></a>6) 插入、删除、移动行和sections</h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">– beginUpdates <span class="comment">// 和endUpdates一起用，让插入、删除、选择操作同时动画，没用过 </span></div><div class="line">– endUpdates <span class="comment">// </span></div><div class="line">– insertRowsAtIndexPaths:withRowAnimation: <span class="comment">//根据indexPath数组插入行 </span></div><div class="line">– deleteRowsAtIndexPaths:withRowAnimation: <span class="comment">//根据indexPath数组删除行 </span></div><div class="line">– moveRowAtIndexPath:toIndexPath: <span class="comment">//移动一行到另一行 </span></div><div class="line">– insertSections:withRowAnimation: <span class="comment">//插入sections </span></div><div class="line">– deleteSections:withRowAnimation: <span class="comment">//删除sections </span></div><div class="line">– moveSection:toSection: <span class="comment">//移动section</span></div></pre></td></tr></table></figure>
<h5 id="7-管理和编辑cell"><a href="#7-管理和编辑cell" class="headerlink" title="7) 管理和编辑cell"></a>7) 管理和编辑cell</h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">  editing  <span class="comment">// YES进入编辑模式，tableview cell会出现插入、删除、重排序的控件 </span></div><div class="line">– setEditing:animated: <span class="comment">//设置进入退出编辑模式</span></div></pre></td></tr></table></figure>
<h5 id="8-重新加载TableView"><a href="#8-重新加载TableView" class="headerlink" title="8) 重新加载TableView"></a>8) 重新加载TableView</h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">– reloadData <span class="comment">// 刷新整个表，包括cells、header、footer，indexs </span></div><div class="line">– reloadRowsAtIndexPaths:withRowAnimation: <span class="comment">// 刷新指定行 </span></div><div class="line">– reloadSections:withRowAnimation: <span class="comment">// 刷新指定组</span></div><div class="line">– reloadSectionIndexTitles <span class="comment">// 刷新组标题</span></div></pre></td></tr></table></figure>
<h5 id="9-访问TableView的画图区"><a href="#9-访问TableView的画图区" class="headerlink" title="9) 访问TableView的画图区"></a>9) 访问TableView的画图区</h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">– rectForSection: <span class="comment">// 返回指定section的矩形 </span></div><div class="line">– rectForRowAtIndexPath: <span class="comment">//返回indexPath指定行的矩形 </span></div><div class="line">– rectForFooterInSection: <span class="comment">// 返回section的footer矩形 </span></div><div class="line">– rectForHeaderInSection: <span class="comment">// 返回section的header矩形</span></div></pre></td></tr></table></figure>
<h5 id="10）展示TableViewCell的简单动画效果"><a href="#10）展示TableViewCell的简单动画效果" class="headerlink" title="10）展示TableViewCell的简单动画效果"></a>10）展示TableViewCell的简单动画效果</h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView willDisplayCell:(<span class="built_in">UITableViewCell</span> *)cell forRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line"></div><div class="line">    <span class="built_in">CATransform3D</span> rotation;</div><div class="line">    rotation = <span class="built_in">CATransform3DMakeRotation</span>( (<span class="number">90.0</span>*M_PI)/<span class="number">180</span>, <span class="number">0.0</span>, <span class="number">0.7</span>, <span class="number">0.4</span>);</div><div class="line">    rotation.m34 = <span class="number">1.0</span>/ <span class="number">-600</span>;</div><div class="line">    </div><div class="line">    cell.layer.shadowColor = [[<span class="built_in">UIColor</span> blackColor]<span class="built_in">CGColor</span>];</div><div class="line">    cell.layer.shadowOffset = <span class="built_in">CGSizeMake</span>(<span class="number">10</span>, <span class="number">10</span>);</div><div class="line">    cell.alpha = <span class="number">0</span>;</div><div class="line">    cell.layer.transform = rotation;</div><div class="line">    cell.layer.anchorPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0.5</span>);</div><div class="line">    </div><div class="line">    </div><div class="line">    [<span class="built_in">UIView</span> beginAnimations:<span class="string">@"rotation"</span> context:<span class="literal">NULL</span>];</div><div class="line">    [<span class="built_in">UIView</span> setAnimationDuration:<span class="number">0.8</span>];</div><div class="line">    cell.layer.transform = <span class="built_in">CATransform3DIdentity</span>;</div><div class="line">    cell.alpha = <span class="number">1</span>;</div><div class="line">    cell.layer.shadowOffset = <span class="built_in">CGSizeMake</span>(<span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    [<span class="built_in">UIView</span> commitAnimations];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/blog/2016/10/10/UITableViewIntro/" class="archive-article-date">
  	<time datetime="2016-10-10T09:21:32.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-10-10</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-DrawRectFunctions" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/10/09/DrawRectFunctions/">CoreGraphics绘制各种图形的方法：写文字、划线、椭圆、矩形、菱形等</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="NO-1画一条线"><a href="#NO-1画一条线" class="headerlink" title="NO.1画一条线"></a>NO.1画一条线</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">CGContextSetRGBStrokeColor</span>(context, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>);<span class="comment">//线条颜色</span></div><div class="line"><span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">20</span>, <span class="number">20</span>);</div><div class="line"><span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">200</span>,<span class="number">20</span>);</div><div class="line"><span class="built_in">CGContextStrokePath</span>(context);</div></pre></td></tr></table></figure>
<h3 id="NO-2写文字"><a href="#NO-2写文字" class="headerlink" title="NO.2写文字"></a>NO.2写文字</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">1.0</span>);</div><div class="line"><span class="built_in">CGContextSetRGBFillColor</span> (context, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>);</div><div class="line"><span class="built_in">UIFont</span> *font = [<span class="built_in">UIFont</span> boldSystemFontOfSize:<span class="number">18.0</span>];</div><div class="line">[<span class="string">@"公司：北京中软科技股份有限公司\n部门：ERP事业部\n姓名：McLiang"</span> drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">20</span>, <span class="number">40</span>, <span class="number">280</span>, <span class="number">300</span>) withFont:font];</div></pre></td></tr></table></figure>
<h3 id="NO-3画一个正方形图形-没有边框"><a href="#NO-3画一个正方形图形-没有边框" class="headerlink" title="NO.3画一个正方形图形 没有边框"></a>NO.3画一个正方形图形 没有边框</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">CGContextSetRGBFillColor</span>(context, <span class="number">0</span>, <span class="number">0.25</span>, <span class="number">0</span>, <span class="number">0.5</span>);</div><div class="line"><span class="built_in">CGContextFillRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">2</span>, <span class="number">2</span>, <span class="number">270</span>, <span class="number">270</span>));</div><div class="line"><span class="built_in">CGContextStrokePath</span>(context);</div></pre></td></tr></table></figure>
<h3 id="NO-4画正方形边框"><a href="#NO-4画正方形边框" class="headerlink" title="NO.4画正方形边框"></a>NO.4画正方形边框</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">CGContextSetRGBStrokeColor</span>(context, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>);<span class="comment">//线条颜色</span></div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">2.0</span>);</div><div class="line"><span class="built_in">CGContextAddRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">2</span>, <span class="number">2</span>, <span class="number">270</span>, <span class="number">270</span>));</div><div class="line"><span class="built_in">CGContextStrokePath</span>(context);</div></pre></td></tr></table></figure>
<h3 id="NO-5画方形背景颜色"><a href="#NO-5画方形背景颜色" class="headerlink" title="NO.5画方形背景颜色"></a>NO.5画方形背景颜色</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">CGContextTranslateCTM</span>(context, <span class="number">0.0</span>f, <span class="keyword">self</span>.bounds.size.height);</div><div class="line"><span class="built_in">CGContextScaleCTM</span>(context, <span class="number">1.0</span>f, <span class="number">-1.0</span>f);</div><div class="line"><span class="built_in">UIGraphicsPushContext</span>(context);</div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(context,<span class="number">320</span>);</div><div class="line"><span class="built_in">CGContextSetRGBStrokeColor</span>(context, <span class="number">250.0</span>/<span class="number">255</span>, <span class="number">250.0</span>/<span class="number">255</span>, <span class="number">210.0</span>/<span class="number">255</span>, <span class="number">1.0</span>);</div><div class="line"><span class="built_in">CGContextStrokeRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">460</span>));</div><div class="line"><span class="built_in">UIGraphicsPopContext</span>();</div></pre></td></tr></table></figure>
<h3 id="NO-6椭圆"><a href="#NO-6椭圆" class="headerlink" title="NO.6椭圆"></a>NO.6椭圆</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">CGRect</span> aRect= <span class="built_in">CGRectMake</span>(<span class="number">80</span>, <span class="number">80</span>, <span class="number">160</span>, <span class="number">100</span>);</div><div class="line"><span class="built_in">CGContextSetRGBStrokeColor</span>(context, <span class="number">0.6</span>, <span class="number">0.9</span>, <span class="number">0</span>, <span class="number">1.0</span>);</div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">3.0</span>);</div><div class="line"><span class="built_in">CGContextAddEllipseInRect</span>(context, aRect); <span class="comment">//椭圆</span></div><div class="line"><span class="built_in">CGContextDrawPath</span>(context, kCGPathStroke);</div></pre></td></tr></table></figure>
<h3 id="NO-7弧线"><a href="#NO-7弧线" class="headerlink" title="NO.7弧线"></a>NO.7弧线</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="comment">//弧线的是通过指定两个切点，还有角度，调用CGContextAddArcToPoint()绘制</span></div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">2.0</span>);</div><div class="line"><span class="built_in">CGContextSetStrokeColorWithColor</span>(context, [<span class="built_in">UIColor</span> blueColor].CGColor);</div><div class="line"><span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>);</div><div class="line"><span class="built_in">CGContextAddArcToPoint</span>(context, <span class="number">100</span>,<span class="number">200</span>, <span class="number">300</span>,<span class="number">200</span>, <span class="number">100</span>);</div><div class="line"><span class="built_in">CGContextStrokePath</span>(context);</div></pre></td></tr></table></figure>
<h3 id="NO-8渐变"><a href="#NO-8渐变" class="headerlink" title="NO.8渐变"></a>NO.8渐变</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">CGContextClip</span>(context);</div><div class="line"><span class="built_in">CGColorSpaceRef</span> rgb = <span class="built_in">CGColorSpaceCreateDeviceRGB</span>();</div><div class="line"><span class="built_in">CGFloat</span> colors[] =</div><div class="line">&#123;</div><div class="line"><span class="number">204.0</span> / <span class="number">255.0</span>, <span class="number">224.0</span> / <span class="number">255.0</span>, <span class="number">244.0</span> / <span class="number">255.0</span>, <span class="number">1.00</span>,</div><div class="line"><span class="number">29.0</span> / <span class="number">255.0</span>, <span class="number">156.0</span> / <span class="number">255.0</span>, <span class="number">215.0</span> / <span class="number">255.0</span>, <span class="number">1.00</span>,</div><div class="line"><span class="number">0.0</span> / <span class="number">255.0</span>, <span class="number">50.0</span> / <span class="number">255.0</span>, <span class="number">126.0</span> / <span class="number">255.0</span>, <span class="number">1.00</span>,</div><div class="line">&#125;;</div><div class="line"><span class="built_in">CGGradientRef</span> gradient = <span class="built_in">CGGradientCreateWithColorComponents</span></div><div class="line">(rgb, colors, <span class="literal">NULL</span>, <span class="keyword">sizeof</span>(colors)/(<span class="keyword">sizeof</span>(colors[<span class="number">0</span>])*<span class="number">4</span>));</div><div class="line"><span class="built_in">CGColorSpaceRelease</span>(rgb);</div><div class="line"><span class="built_in">CGContextDrawLinearGradient</span>(context, gradient,<span class="built_in">CGPointMake</span></div><div class="line">(<span class="number">0.0</span>,<span class="number">0.0</span>) ,<span class="built_in">CGPointMake</span>(<span class="number">0.0</span>,<span class="keyword">self</span>.frame.size.height),</div><div class="line">kCGGradientDrawsBeforeStartLocation);</div></pre></td></tr></table></figure>
<h3 id="NO-9四条线画一个正方形"><a href="#NO-9四条线画一个正方形" class="headerlink" title="NO.9四条线画一个正方形"></a>NO.9四条线画一个正方形</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//画线</span></div><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">UIColor</span> *aColor = [<span class="built_in">UIColor</span> colorWithRed:<span class="number">0</span> green:<span class="number">1.0</span> blue:<span class="number">0</span> alpha:<span class="number">0</span>];</div><div class="line"><span class="built_in">CGContextSetRGBStrokeColor</span>(context, <span class="number">1.0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1.0</span>);</div><div class="line"><span class="built_in">CGContextSetFillColorWithColor</span>(context, aColor.CGColor);</div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">4.0</span>);</div><div class="line"><span class="built_in">CGPoint</span> aPoints[<span class="number">5</span>];</div><div class="line">aPoints[<span class="number">0</span>] =<span class="built_in">CGPointMake</span>(<span class="number">60</span>, <span class="number">60</span>);</div><div class="line">aPoints[<span class="number">1</span>] =<span class="built_in">CGPointMake</span>(<span class="number">260</span>, <span class="number">60</span>);</div><div class="line">aPoints[<span class="number">2</span>] =<span class="built_in">CGPointMake</span>(<span class="number">260</span>, <span class="number">300</span>);</div><div class="line">aPoints[<span class="number">3</span>] =<span class="built_in">CGPointMake</span>(<span class="number">60</span>, <span class="number">300</span>);</div><div class="line">aPoints[<span class="number">4</span>] =<span class="built_in">CGPointMake</span>(<span class="number">60</span>, <span class="number">60</span>);</div><div class="line"><span class="built_in">CGContextAddLines</span>(context, aPoints, <span class="number">5</span>);</div><div class="line"><span class="built_in">CGContextDrawPath</span>(context, kCGPathStroke); <span class="comment">//开始画线</span></div></pre></td></tr></table></figure>
<h3 id="NO-10椭圆"><a href="#NO-10椭圆" class="headerlink" title="NO.10椭圆"></a>NO.10椭圆</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">UIColor</span> *aColor = [<span class="built_in">UIColor</span> colorWithRed:<span class="number">0</span> green:<span class="number">1.0</span> blue:<span class="number">0</span> alpha:<span class="number">0</span>];</div><div class="line"><span class="built_in">CGContextSetRGBStrokeColor</span>(context, <span class="number">1.0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1.0</span>);</div><div class="line"><span class="built_in">CGContextSetFillColorWithColor</span>(context, aColor.CGColor);</div><div class="line"></div><div class="line"><span class="built_in">CGRect</span> aRect= <span class="built_in">CGRectMake</span>(<span class="number">80</span>, <span class="number">80</span>, <span class="number">160</span>, <span class="number">100</span>);</div><div class="line"><span class="built_in">CGContextSetRGBStrokeColor</span>(context, <span class="number">0.6</span>, <span class="number">0.9</span>, <span class="number">0</span>, <span class="number">1.0</span>);</div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">3.0</span>);</div><div class="line"><span class="built_in">CGContextSetFillColorWithColor</span>(context, aColor.CGColor);</div><div class="line"><span class="built_in">CGContextAddRect</span>(context, rect); <span class="comment">//矩形</span></div><div class="line"><span class="built_in">CGContextAddEllipseInRect</span>(context, aRect); <span class="comment">//椭圆</span></div><div class="line"><span class="built_in">CGContextDrawPath</span>(context, kCGPathStroke);</div></pre></td></tr></table></figure>
<h3 id="NO-11实心圆"><a href="#NO-11实心圆" class="headerlink" title="NO.11实心圆"></a>NO.11实心圆</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">画一个实心的圆</div><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">CGContextFillEllipseInRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">95</span>, <span class="number">95</span>, <span class="number">100.0</span>, <span class="number">100</span>));</div></pre></td></tr></table></figure>
<h3 id="NO-12"><a href="#NO-12" class="headerlink" title="NO.12"></a>NO.12</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">画一个菱形</div><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">2.0</span>);</div><div class="line"><span class="built_in">CGContextSetStrokeColorWithColor</span>(context, [<span class="built_in">UIColor</span> blueColor].CGColor);</div><div class="line"><span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>);</div><div class="line"><span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">150</span>, <span class="number">150</span>);</div><div class="line"><span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">200</span>);</div><div class="line"><span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">50</span>, <span class="number">150</span>);</div><div class="line"><span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>);</div><div class="line"><span class="built_in">CGContextStrokePath</span>(context);</div></pre></td></tr></table></figure>
<h3 id="NO-13-画矩形"><a href="#NO-13-画矩形" class="headerlink" title="NO.13 画矩形"></a>NO.13 画矩形</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">2.0</span>);</div><div class="line"><span class="built_in">CGContextSetStrokeColorWithColor</span>(context, [<span class="built_in">UIColor</span> blueColor].CGColor);</div><div class="line"><span class="built_in">CGRect</span> rectangle = <span class="built_in">CGRectMake</span>(<span class="number">60</span>,<span class="number">170</span>,<span class="number">200</span>,<span class="number">80</span>);</div><div class="line"><span class="built_in">CGContextAddRect</span>(context, rectangle);</div><div class="line"><span class="built_in">CGContextStrokePath</span>(context);</div></pre></td></tr></table></figure>
<p>###NO.11填充一个蓝色边的红色矩形</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">2.0</span>);</div><div class="line"><span class="built_in">CGContextSetStrokeColorWithColor</span>(context, [<span class="built_in">UIColor</span> blueColor].CGColor);</div><div class="line"><span class="built_in">CGRect</span> rectangle = <span class="built_in">CGRectMake</span>(<span class="number">60</span>,<span class="number">170</span>,<span class="number">200</span>,<span class="number">80</span>);</div><div class="line"><span class="built_in">CGContextAddRect</span>(context, rectangle);</div><div class="line"><span class="built_in">CGContextStrokePath</span>(context);</div><div class="line"><span class="built_in">CGContextSetFillColorWithColor</span>(context, [<span class="built_in">UIColor</span> redColor].CGColor);</div><div class="line"><span class="built_in">CGContextFillRect</span>(context, rectangle);</div></pre></td></tr></table></figure>
<h3 id="NO-12绘制贝兹曲线"><a href="#NO-12绘制贝兹曲线" class="headerlink" title="NO.12绘制贝兹曲线"></a>NO.12绘制贝兹曲线</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//贝兹曲线是通过移动一个起始点，然后通过两个控制点,还有一个中止点，调用</span></div><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">CGContextAddCurveToPoint</span>() 函数绘制</div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">2.0</span>);</div><div class="line"><span class="built_in">CGContextSetStrokeColorWithColor</span>(context, [<span class="built_in">UIColor</span> blueColor].CGColor);</div><div class="line"><span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">10</span>, <span class="number">10</span>);</div><div class="line"><span class="built_in">CGContextAddCurveToPoint</span>(context, <span class="number">0</span>, <span class="number">50</span>, <span class="number">300</span>, <span class="number">250</span>, <span class="number">300</span>, <span class="number">400</span>);</div><div class="line"><span class="built_in">CGContextStrokePath</span>(context);</div></pre></td></tr></table></figure>
<h3 id="NO-13绘制二次贝兹曲线"><a href="#NO-13绘制二次贝兹曲线" class="headerlink" title="NO.13绘制二次贝兹曲线"></a>NO.13绘制二次贝兹曲线</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">2.0</span>);</div><div class="line"></div><div class="line"><span class="built_in">CGContextSetStrokeColorWithColor</span>(context, [<span class="built_in">UIColor</span> blueColor].CGColor);</div><div class="line"><span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">10</span>, <span class="number">200</span>);</div><div class="line"><span class="built_in">CGContextAddQuadCurveToPoint</span>(context, <span class="number">150</span>, <span class="number">10</span>, <span class="number">300</span>, <span class="number">200</span>);</div><div class="line"><span class="built_in">CGContextStrokePath</span>(context);</div></pre></td></tr></table></figure>
<h3 id="NO-14绘制虚线"><a href="#NO-14绘制虚线" class="headerlink" title="NO.14绘制虚线"></a>NO.14绘制虚线</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">5.0</span>);</div><div class="line"><span class="built_in">CGContextSetStrokeColorWithColor</span>(context, [<span class="built_in">UIColor</span> blueColor].CGColor);</div><div class="line"><span class="built_in">CGFloat</span> dashArray[] = &#123;<span class="number">2</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">2</span>&#125;;</div><div class="line"><span class="built_in">CGContextSetLineDash</span>(context, <span class="number">3</span>, dashArray, <span class="number">4</span>);<span class="comment">//跳过3个再画虚线，所以刚开始有6-（3-2）=5个虚点</span></div><div class="line"><span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">10</span>, <span class="number">200</span>);</div><div class="line"><span class="built_in">CGContextAddQuadCurveToPoint</span>(context, <span class="number">150</span>, <span class="number">10</span>, <span class="number">300</span>, <span class="number">200</span>);</div><div class="line"><span class="built_in">CGContextStrokePath</span>(context);</div></pre></td></tr></table></figure>
<h3 id="NO-15绘制图片"><a href="#NO-15绘制图片" class="headerlink" title="NO.15绘制图片"></a>NO.15绘制图片</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="built_in">NSString</span>* imagePath = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"dog"</span> ofType:<span class="string">@"png"</span>];</div><div class="line"><span class="built_in">UIImage</span>* myImageObj = [[<span class="built_in">UIImage</span> alloc] initWithContentsOfFile:imagePath];</div><div class="line"><span class="comment">//[myImageObj drawAtPoint:CGPointMake(0, 0)];</span></div><div class="line">[myImageObj drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">480</span>)];</div><div class="line"></div><div class="line"><span class="built_in">NSString</span> *s = <span class="string">@"我的小狗"</span>;</div><div class="line"></div><div class="line">[s drawAtPoint:<span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">0</span>) withFont:[<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">34.0</span>]];</div><div class="line"></div><div class="line"><span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"dog"</span> ofType:<span class="string">@"png"</span>];</div><div class="line"><span class="built_in">UIImage</span> *img = [<span class="built_in">UIImage</span> imageWithContentsOfFile:path];</div><div class="line"><span class="built_in">CGImageRef</span> image = img.CGImage;</div><div class="line"><span class="built_in">CGContextSaveGState</span>(context);</div><div class="line"><span class="built_in">CGRect</span> touchRect = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, img.size.width, img.size.height);</div><div class="line"><span class="built_in">CGContextDrawImage</span>(context, touchRect, image);</div><div class="line"><span class="built_in">CGContextRestoreGState</span>(context);</div><div class="line"></div><div class="line"><span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"dog"</span> ofType:<span class="string">@"png"</span>];</div><div class="line"><span class="built_in">UIImage</span> *img = [<span class="built_in">UIImage</span> imageWithContentsOfFile:path];</div><div class="line"><span class="built_in">CGImageRef</span> image = img.CGImage;</div><div class="line"><span class="built_in">CGContextSaveGState</span>(context);</div><div class="line"></div><div class="line"><span class="built_in">CGContextRotateCTM</span>(context, M_PI);</div><div class="line"><span class="built_in">CGContextTranslateCTM</span>(context, -img.size.width, -img.size.height);</div><div class="line"></div><div class="line"><span class="built_in">CGRect</span> touchRect = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, img.size.width, img.size.height);</div><div class="line"><span class="built_in">CGContextDrawImage</span>(context, touchRect, image);</div><div class="line"><span class="built_in">CGContextRestoreGState</span>(context);*/</div><div class="line"></div><div class="line"><span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"dog"</span> ofType:<span class="string">@"png"</span>];</div><div class="line"><span class="built_in">UIImage</span> *img = [<span class="built_in">UIImage</span> imageWithContentsOfFile:path];</div><div class="line"><span class="built_in">CGImageRef</span> image = img.CGImage;</div><div class="line"></div><div class="line"><span class="built_in">CGContextSaveGState</span>(context);</div><div class="line"></div><div class="line"><span class="built_in">CGAffineTransform</span> myAffine = <span class="built_in">CGAffineTransformMakeRotation</span>(M_PI);</div><div class="line">myAffine = <span class="built_in">CGAffineTransformTranslate</span>(myAffine, -img.size.width, -img.size.height);</div><div class="line"><span class="built_in">CGContextConcatCTM</span>(context, myAffine);</div><div class="line"></div><div class="line"><span class="built_in">CGContextRotateCTM</span>(context, M_PI);</div><div class="line"><span class="built_in">CGContextTranslateCTM</span>(context, -img.size.width, -img.size.height);</div><div class="line"></div><div class="line"><span class="built_in">CGRect</span> touchRect = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, img.size.width, img.size.height);</div><div class="line"><span class="built_in">CGContextDrawImage</span>(context, touchRect, image);</div><div class="line"><span class="built_in">CGContextRestoreGState</span>(context);</div></pre></td></tr></table></figure>
<h3 id="NO-16画圆角矩形"><a href="#NO-16画圆角矩形" class="headerlink" title="NO.16画圆角矩形"></a>NO.16画圆角矩形</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"> <span class="comment">//	矩形的宽和高</span></div><div class="line"><span class="built_in">CGFloat</span> width = <span class="number">100</span>;</div><div class="line"><span class="built_in">CGFloat</span> height = <span class="number">80</span>;</div><div class="line"><span class="comment">// 简便起见，这里把圆角半径设置为长和宽平均值的1/10</span></div><div class="line"><span class="built_in">CGFloat</span> radius = (width + height) * <span class="number">0.05</span>;</div><div class="line"> </div><div class="line"><span class="comment">// 获取CGContext，注意UIKit里用的是一个专门的函数</span></div><div class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="comment">// 移动到初始点</span></div><div class="line"><span class="built_in">CGContextMoveToPoint</span>(context, radius, <span class="number">0</span>);</div><div class="line"> </div><div class="line"><span class="comment">// 绘制第1条线和第1个1/4圆弧</span></div><div class="line"><span class="built_in">CGContextAddLineToPoint</span>(context, width - radius, <span class="number">0</span>);</div><div class="line"><span class="built_in">CGContextAddArc</span>(context, width - radius, radius, radius, <span class="number">-0.5</span> * M_PI, <span class="number">0.0</span>, <span class="number">0</span>);</div><div class="line"> </div><div class="line"><span class="comment">// 绘制第2条线和第2个1/4圆弧</span></div><div class="line"><span class="built_in">CGContextAddLineToPoint</span>(context, width, height - radius);</div><div class="line"><span class="built_in">CGContextAddArc</span>(context, width - radius, height - radius, radius, <span class="number">0.0</span>, <span class="number">0.5</span> * M_PI, <span class="number">0</span>);</div><div class="line"> </div><div class="line"><span class="comment">// 绘制第3条线和第3个1/4圆弧</span></div><div class="line"><span class="built_in">CGContextAddLineToPoint</span>(context, radius, height);</div><div class="line"><span class="built_in">CGContextAddArc</span>(context, radius, height - radius, radius, <span class="number">0.5</span> * M_PI, M_PI, <span class="number">0</span>);</div><div class="line"> </div><div class="line"><span class="comment">// 绘制第4条线和第4个1/4圆弧</span></div><div class="line"><span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">0</span>, radius);</div><div class="line"><span class="built_in">CGContextAddArc</span>(context, radius, radius, radius, M_PI, <span class="number">1.5</span> * M_PI, <span class="number">0</span>);</div><div class="line"> </div><div class="line"><span class="comment">// 闭合路径</span></div><div class="line"><span class="built_in">CGContextClosePath</span>(context);</div><div class="line"><span class="comment">// 填充半透明黑色</span></div><div class="line"><span class="built_in">CGContextSetRGBFillColor</span>(context, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.5</span>);</div><div class="line"><span class="built_in">CGContextDrawPath</span>(context, kCGPathFill);</div></pre></td></tr></table></figure>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/blog/2016/10/09/DrawRectFunctions/" class="archive-article-date">
  	<time datetime="2016-10-09T05:54:01.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-10-09</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 晨星、风
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: false,
		mathjax: false,
		animate: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/blog/",
		innerArchive: false
	}
</script>

<script src="/blog/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
  </ul>
  <div class="tools-wrap">
    

    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="https://developer.apple.com/news/">Apple Developer News</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="https://onevcat.com">Onevcat的博客</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.sunnyxx.com">Sunny的博客</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.devtang.com">唐巧的博客</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://kittenyang.com">杨骑滔的博客</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://ericasadun.com">Erica Sadun的博客</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="https://mikeash.com/pyblog/">Mike Ash的博客</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://jspahrsummers.com">ustin Spahr-Summers的博客</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://samvermette.com">Sam Vermette的博客</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="https://ashfurrow.com">Ash Furrow的博客</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.jessesquires.com">Jesse Squires的博客</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://tech.meituan.com">美团点评技术博客</a>
  	        
  	        </div>
  		
    	</section>
    

    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>